<!doctype html>
<html>
﻿
<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3-i2c/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:10:13 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>EV3 I2C</title>
    <link rel="alternate" type="application/atom+xml" href="../../../news/atom.xml" title="Atom feed">
    <link rel="stylesheet" href="../../../stylesheets/styles.css">
    <link rel="stylesheet" href="../../../stylesheets/pygment_trac.css">
    <script src="../../../../ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="../../../javascripts/jquery.getUrlParam.js"></script>
    <script src="../../../javascripts/jquery.loadTemplate-1.4.4.min.js"></script>
    <script src="../../../javascripts/respond.js"></script>
    <script src="../../../javascripts/cards.js"></script>
    <script src="../../../javascripts/menu.js"></script>
    <script src="../../../javascripts/search.js"></script>
    <script src="../../../javascripts/tabs.js"></script>
    <script src="../../../javascripts/ua-parser.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script type="text/html" id="search-result-template">
        <div class="search-result">
            <a data-href="href"><h4 data-content="title"></h4></a>
            <span data-content="breadcrumbs" class="search-result-breadcrumbs"></span>
            <span data-content="author" class="search-result-author"></span><br/>
            <span data-content="date" class="search-result-date"></span>
        </div>
    </script>

</head>

<body>
    <div id="header" class="mobile-hidden">
    <nav>
        <li class="nav-menu">
            <img src="../../../images/menu.png" />
        </li>

        <li class="left button">
            <a href="../../../index.html" title="There's no place like Home...">Home</a>
        </li>
        <li class="left button">
            <a href="../../index.html" title="Documentation on how to use ev3dev">Docs</a>
        </li>
        <li class="left button">
            <a href="../../../news/index.html" title="News about ev3dev">News</a>
        </li>
        <li class="left button dropdown-button">
            <a>
                Community
                <div class="nav-dropdown-arrow">
                    
                </div>
            </a>
            <ul class="button-dropdown">
                <li>
                    <a href="../../../share/index.html" title="Discover and share projects that use ev3dev">Share</a>
                </li>
                <li>
                    <a href="../../../contribute/index.html" title="How to contribute to ev3dev">Contribute</a>
                </li>
                <li>
                    <a href="../../../support/index.html" title="Found a bug? Have a question?">Get Help</a>
                </li>
            </ul>
        </li>
        <li class="left button">
            <a href="https://github.com/ev3dev/ev3dev/releases" title="SD card image files">Download</a>
        </li>
        <!-- items below float right, so appear in reverse order -->
        <li class="right header-box" id="search-li">
            <input type="text" id="search-input" onfocus="searchFocus()" onkeyup="searchTextChanged()" placeholder="Quick Nav" onkeypress="this.onkeyup();" onpaste="this.onkeyup();" oninput="this.onkeyup();" />
            <div id="search-dropdown">
                <div class="search-results-container" id="search-results-docs">
                    <h2>In docs</h2>
                    <div data-content="docs-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-projects">
                    <h2>In projects</h2>
                    <div data-content="project-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-news">
                    <h2>In news</h2>
                    <div data-content="news-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-misc">
                    <h2>In other pages</h2>
                    <div data-content="misc-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>
            </div>
        </li>
    </nav>
</div>

<!-- make sure this get included on every page -->
<!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <div class="wrapper">
        <section>
            <div id="title">
    <div id="logoContainer">
        <a href="../../../index.html">
            <img id="logo" src="../../../../avatars3.githubusercontent.com/u/6878323782c.png?s=140" />
        </a>
        <div id="titleHeader" class="clear">
            <h1 id="pageTitle">EV3 I2C</h1>
            <p id="pageSubtitle"></p>
        </div>
    </div>
    <hr class="clear">
</div>


            <div id="mainContent">
                
    

<div class="edit-on-github">
<a href="https://github.com/ev3dev/ev3dev.github.io/edit/master/docs/kernel-hackers-notebook/ev3-i2c.md">Edit on Github</a>
</div>
<div class="breadcrumbs">
﻿


    
        
        <a href="../../index.html">docs</a> &gt;
    

    
        
        <a href="../index.html">kernel-hackers-notebook</a> &gt;
    

    
        ev3-i2c
    


</div>
<hr />

<p>The <a href="ev3-processor.html">AM1808 SoC</a> has 2 hardware <a href="https://en.wikipedia.org/wiki/I2c">Inter-Integrated Circuit</a> (I2C) controllers. Additionally, there are 4 software controllers implemented using <a href="../ev3-fiq/index.html">fast interrupts</a> (FIQs).</p>

<h2 id="usage">Usage</h2>

<p><strong>I2C0</strong>: <a href="../ev3-eeprom/index.html">Boot EEPROM</a> <a href="https://github.com/400kHz" class="user-mention">@400kHz</a></p>

<p><strong>I2C1</strong>: Not used/connected</p>

<p><strong><a href="ev3-fiq.html">FIQ</a> I2C</strong>: Input ports 1-4 <a href="https://github.com/10kHz" class="user-mention">@10kHz</a></p>

<h2 id="device-drivers">Device Drivers</h2>

<p>The Linux kernel has a well established <a href="https://www.kernel.org/doc/Documentation/i2c/">framework for I2C drivers</a>.</p>

<p>The SoC I2C uses the existing driver at <a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/i2c/busses/i2c-davinci.html">drivers/i2c/busses/i2c-davinci.c</a> as a backend.</p>

<p>Since there are not enough I2C controllers on the SoC, LEGO chose to implement the I2C buses for the four input ports using GPIOs. A secondary reason for this is that the NXT Ultrasonic sensors does not work well with standard I2C masters. It requires an extra clock pulse between the stop and the next start. (TODO: add references here.) </p>

<p>This Linux kernel has an existing GPIO i2c driver, but in order to get the performance needed, we have to use <a href="EV3%20FIQ.html">fast interrupts</a> (FIQs). (Be sure to follow the link for some interesting reading.) So, the really low level stuff is done in <a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/arch/arm/mach-davinci/legoev3-fiq.html">arch/arm/mach-davinci/legoev3-fiq.c</a> and the rest is in <a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/i2c/busses/i2c-legoev3.html">drivers/i2c/busses/i2c-legoev3.c</a>.</p>

<h2 id="i2c-addressing">I2C Addressing</h2>

<p>See <a href="../../sensors/i2c-sensor-addressing/index.html">I2C Sensor Addressing</a>.</p>

            </div>
        </section>
        <div id="footer">
    <hr class="clear">
    <div class="cclicense">

        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">
            www.ev3dev.org (with the exception of the projects pages)
        </span>
        is licensed under
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="../../../../licensebuttons.net/l/by-sa/4.0/80x15.png" />
        </a>.
        <br />
        You are free to copy the text and images, but please be courteous and acknowledge the source.

    </div>
    <br />
    <hr class="clear">
    <span class="credits left">
        Project maintained by <a href="https://github.com/rhempel">Ralph Hempel</a>
        and <a href="https://github.com/dlech">David Lechner</a>, with help from the community
    </span>
    <span class="credits right">
        Hosted on GitHub Pages <!--&mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a>-->
    </span>
</div>

    </div>
</body>

<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3-i2c/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:12:27 GMT -->
</html>
