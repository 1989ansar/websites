<!doctype html>
<html>
﻿
<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3-eeprom/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:12:30 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>EV3 EEPROM</title>
    <link rel="alternate" type="application/atom+xml" href="../../../news/atom.xml" title="Atom feed">
    <link rel="stylesheet" href="../../../stylesheets/styles.css">
    <link rel="stylesheet" href="../../../stylesheets/pygment_trac.css">
    <script src="../../../../ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="../../../javascripts/jquery.getUrlParam.js"></script>
    <script src="../../../javascripts/jquery.loadTemplate-1.4.4.min.js"></script>
    <script src="../../../javascripts/respond.js"></script>
    <script src="../../../javascripts/cards.js"></script>
    <script src="../../../javascripts/menu.js"></script>
    <script src="../../../javascripts/search.js"></script>
    <script src="../../../javascripts/tabs.js"></script>
    <script src="../../../javascripts/ua-parser.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script type="text/html" id="search-result-template">
        <div class="search-result">
            <a data-href="href"><h4 data-content="title"></h4></a>
            <span data-content="breadcrumbs" class="search-result-breadcrumbs"></span>
            <span data-content="author" class="search-result-author"></span><br/>
            <span data-content="date" class="search-result-date"></span>
        </div>
    </script>

</head>

<body>
    <div id="header" class="mobile-hidden">
    <nav>
        <li class="nav-menu">
            <img src="../../../images/menu.png" />
        </li>

        <li class="left button">
            <a href="../../../index.html" title="There's no place like Home...">Home</a>
        </li>
        <li class="left button">
            <a href="../../index.html" title="Documentation on how to use ev3dev">Docs</a>
        </li>
        <li class="left button">
            <a href="../../../news/index.html" title="News about ev3dev">News</a>
        </li>
        <li class="left button dropdown-button">
            <a>
                Community
                <div class="nav-dropdown-arrow">
                    
                </div>
            </a>
            <ul class="button-dropdown">
                <li>
                    <a href="../../../share/index.html" title="Discover and share projects that use ev3dev">Share</a>
                </li>
                <li>
                    <a href="../../../contribute/index.html" title="How to contribute to ev3dev">Contribute</a>
                </li>
                <li>
                    <a href="../../../support/index.html" title="Found a bug? Have a question?">Get Help</a>
                </li>
            </ul>
        </li>
        <li class="left button">
            <a href="https://github.com/ev3dev/ev3dev/releases" title="SD card image files">Download</a>
        </li>
        <!-- items below float right, so appear in reverse order -->
        <li class="right header-box" id="search-li">
            <input type="text" id="search-input" onfocus="searchFocus()" onkeyup="searchTextChanged()" placeholder="Quick Nav" onkeypress="this.onkeyup();" onpaste="this.onkeyup();" oninput="this.onkeyup();" />
            <div id="search-dropdown">
                <div class="search-results-container" id="search-results-docs">
                    <h2>In docs</h2>
                    <div data-content="docs-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-projects">
                    <h2>In projects</h2>
                    <div data-content="project-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-news">
                    <h2>In news</h2>
                    <div data-content="news-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-misc">
                    <h2>In other pages</h2>
                    <div data-content="misc-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>
            </div>
        </li>
    </nav>
</div>

<!-- make sure this get included on every page -->
<!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <div class="wrapper">
        <section>
            <div id="title">
    <div id="logoContainer">
        <a href="../../../index.html">
            <img id="logo" src="../../../../avatars3.githubusercontent.com/u/6878323782c.png?s=140" />
        </a>
        <div id="titleHeader" class="clear">
            <h1 id="pageTitle">EV3 EEPROM</h1>
            <p id="pageSubtitle"></p>
        </div>
    </div>
    <hr class="clear">
</div>


            <div id="mainContent">
                
    

<div class="edit-on-github">
<a href="https://github.com/ev3dev/ev3dev.github.io/edit/master/docs/kernel-hackers-notebook/ev3-eeprom.md">Edit on Github</a>
</div>
<div class="breadcrumbs">
﻿


    
        
        <a href="../../index.html">docs</a> &gt;
    

    
        
        <a href="../index.html">kernel-hackers-notebook</a> &gt;
    

    
        ev3-eeprom
    


</div>
<hr />

<h2 id="essentials">Essentials</h2>

<ul>
  <li>Microchip 24FC128</li>
  <li>16K (128K in datasheet means 128Kbit = 16Kbyte)</li>
  <li>Write protected (read-only)</li>
  <li>Data stored:
    <ul>
      <li>0x0000-0x3567: Boot loader</li>
      <li>0x3F00: Hardware Version</li>
      <li>0x3F01: Bitwise complement of hardware version (see notes below)</li>
      <li>0x3F06-0x3F11: Bluetooth MAC address</li>
    </ul>
  </li>
</ul>

<h2 id="documentation">Documentation</h2>

<ul>
  <li><a href="https://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en010800">Webite</a></li>
  <li><a href="../../../../ww1.microchip.com/downloads/en/DeviceDoc/21191s.pdf">Datasheet (pdf)</a></li>
</ul>

<h2 id="important-note">IMPORTANT NOTE!!!!</h2>

<p>The data read from this EEPROM will be corrupt (first byte &amp;= 0x42) unless the on-board bluetooth has been properly initialized! The on-board bluetooth shares the same i2c bus. GPIO 5,7 is connected to the SCL line and is used by the bluetooth driver to monitor if the I2C bus is busy. If this GPIO is not set to input, then it will hold the clock line high or low.</p>

<h2 id="sysfs">sysfs</h2>

<h3 id="nodes">Nodes</h3>

<pre><code>/sys/devices/platform/i2c_davinci.1/i2c-1/1-0050
/sys/bus/i2c/drivers/at24/1-0050
</code></pre>

<h3 id="attribues">attribues</h3>

<ul>
  <li><code>eeprom</code>: binary file used to read EEPROM data.</li>
  <li><code>name</code>: name of the device (“24c128”)</li>
</ul>

<h2 id="boot-loader">Boot loader</h2>

<p>If you have a serial terminal connected to Input Port 1, you will see the following message that comes from the EEPROM boot loader:</p>

<pre><code>EV3 initialization passed!
Booting EV3 EEprom Boot Loader

        EEprom Version:   0.60
        EV3 Flashtype:    N25Q128A13B

EV3 Booting system

Jumping to entry point at: 0xC1080000
</code></pre>

<p>NOTE: You can enter firmware update mode by writing 0x5555AAAA to memory address 0xFFFF1FFA (part of the 128K on-chip ram of the AM1808 processor) and then rebooting with <code>reboot -d -f -i</code>. This reboots without properly shutting down (see <code>reboot --help</code>), so we don’t want to do this in ev3dev. On the official LEGO firmware, the firmware update writes over everything so it doesn’t matter if it does not shut down properly. </p>

<h2 id="hardware-version">Hardware Version</h2>

<p>The hardware version is a 16 bit unsigned integer.</p>

<p>It appears that version 3 did not have the hardware version in the EEPROM. The complement of the hardware version is used to check for this. (Let A = data at 0x3F00 and B = data at 0x3F01, then if A XOR B == 0xFF, then we have hardware version = A, else we have hardware version = 3).</p>

<p>Get hardware version:</p>

<pre><code>hexdump -e '"V0.%02X"' -s 0x3f00 -n 1 &lt; /sys/bus/i2c/drivers/at24/1-0050/eeprom
</code></pre>

<h3 id="list-of-hardware-versions-from-lms2012h">List of hardware versions from lms2012.h</h3>

<pre><code>//  V1.00     10      10        MP      (h = home, e = education)
//  V0.50     05      5         EP3
//  V0.40     04      4         EP2
//  V0.30     03      3         EP1     (FINALB)  (DEFAULT if file "HwId" not found)
//  V0.20     02      2         FINAL
</code></pre>

<p>It appears that LEGO dropped the idea of having hardware version 1.00 for mass produced models and elected to use 0.60 instead.</p>

<h3 id="list-of-hardware-versions-in-the-wild">List of hardware versions in the wild</h3>

<p>If your EV3 has a hardware version not on this list, please add it</p>

<ul>
  <li>0.60 (0x06)</li>
</ul>

<h2 id="bluetooth-mac-address">Bluetooth MAC address</h2>

<p>NOTE: On hardware version 3, the bluetooth address starts at 0x3F00 instead of 0x3F06.</p>

<p>LEGO’s manufacturer ID is 00:16:53, so these should always be the first 3 16-bit words. The last 3 words are unique to each individual EV3.</p>

<p>Get formatted bluetooth MAC address:</p>

<pre><code>hexdump -e '5/1 "%02X:" "%02X"' -s 0x3f06 -n 6 &lt; /sys/bus/i2c/drivers/at24/1-0050/eeprom
</code></pre>

            </div>
        </section>
        <div id="footer">
    <hr class="clear">
    <div class="cclicense">

        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">
            www.ev3dev.org (with the exception of the projects pages)
        </span>
        is licensed under
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="../../../../licensebuttons.net/l/by-sa/4.0/80x15.png" />
        </a>.
        <br />
        You are free to copy the text and images, but please be courteous and acknowledge the source.

    </div>
    <br />
    <hr class="clear">
    <span class="credits left">
        Project maintained by <a href="https://github.com/rhempel">Ralph Hempel</a>
        and <a href="https://github.com/dlech">David Lechner</a>, with help from the community
    </span>
    <span class="credits right">
        Hosted on GitHub Pages <!--&mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a>-->
    </span>
</div>

    </div>
</body>

<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3-eeprom/ by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:12:32 GMT -->
</html>
