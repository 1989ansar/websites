<!doctype html>
<html>
﻿
<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3dev-linux-kernel/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:28:19 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>ev3dev Linux Kernel</title>
    <link rel="alternate" type="application/atom+xml" href="../../../news/atom.xml" title="Atom feed">
    <link rel="stylesheet" href="../../../stylesheets/styles.css">
    <link rel="stylesheet" href="../../../stylesheets/pygment_trac.css">
    <script src="../../../../ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
    <script src="../../../javascripts/jquery.getUrlParam.js"></script>
    <script src="../../../javascripts/jquery.loadTemplate-1.4.4.min.js"></script>
    <script src="../../../javascripts/respond.js"></script>
    <script src="../../../javascripts/cards.js"></script>
    <script src="../../../javascripts/menu.js"></script>
    <script src="../../../javascripts/search.js"></script>
    <script src="../../../javascripts/tabs.js"></script>
    <script src="../../../javascripts/ua-parser.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <script type="text/html" id="search-result-template">
        <div class="search-result">
            <a data-href="href"><h4 data-content="title"></h4></a>
            <span data-content="breadcrumbs" class="search-result-breadcrumbs"></span>
            <span data-content="author" class="search-result-author"></span><br/>
            <span data-content="date" class="search-result-date"></span>
        </div>
    </script>

</head>

<body>
    <div id="header" class="mobile-hidden">
    <nav>
        <li class="nav-menu">
            <img src="../../../images/menu.png" />
        </li>

        <li class="left button">
            <a href="../../../index.html" title="There's no place like Home...">Home</a>
        </li>
        <li class="left button">
            <a href="../../index.html" title="Documentation on how to use ev3dev">Docs</a>
        </li>
        <li class="left button">
            <a href="../../../news/index.html" title="News about ev3dev">News</a>
        </li>
        <li class="left button dropdown-button">
            <a>
                Community
                <div class="nav-dropdown-arrow">
                    
                </div>
            </a>
            <ul class="button-dropdown">
                <li>
                    <a href="../../../share/index.html" title="Discover and share projects that use ev3dev">Share</a>
                </li>
                <li>
                    <a href="../../../contribute/index.html" title="How to contribute to ev3dev">Contribute</a>
                </li>
                <li>
                    <a href="../../../support/index.html" title="Found a bug? Have a question?">Get Help</a>
                </li>
            </ul>
        </li>
        <li class="left button">
            <a href="https://github.com/ev3dev/ev3dev/releases" title="SD card image files">Download</a>
        </li>
        <!-- items below float right, so appear in reverse order -->
        <li class="right header-box" id="search-li">
            <input type="text" id="search-input" onfocus="searchFocus()" onkeyup="searchTextChanged()" placeholder="Quick Nav" onkeypress="this.onkeyup();" onpaste="this.onkeyup();" oninput="this.onkeyup();" />
            <div id="search-dropdown">
                <div class="search-results-container" id="search-results-docs">
                    <h2>In docs</h2>
                    <div data-content="docs-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-projects">
                    <h2>In projects</h2>
                    <div data-content="project-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-news">
                    <h2>In news</h2>
                    <div data-content="news-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>

                <div class="search-results-container" id="search-results-misc">
                    <h2>In other pages</h2>
                    <div data-content="misc-results">
                        <div class="no-results-note">No results</div>
                    </div>
                </div>
            </div>
        </li>
    </nav>
</div>

<!-- make sure this get included on every page -->
<!--[if !IE]><script>fixScale(document);</script><![endif]-->

    <div class="wrapper">
        <section>
            <div id="title">
    <div id="logoContainer">
        <a href="../../../index.html">
            <img id="logo" src="../../../../avatars3.githubusercontent.com/u/6878323782c.png?s=140" />
        </a>
        <div id="titleHeader" class="clear">
            <h1 id="pageTitle">ev3dev Linux Kernel</h1>
            <p id="pageSubtitle"></p>
        </div>
    </div>
    <hr class="clear">
</div>


            <div id="mainContent">
                
    

<div class="edit-on-github">
<a href="https://github.com/ev3dev/ev3dev.github.io/edit/master/docs/kernel-hackers-notebook/ev3dev-linux-kernel.md">Edit on Github</a>
</div>
<div class="breadcrumbs">
﻿


    
        
        <a href="../../index.html">docs</a> &gt;
    

    
        
        <a href="../index.html">kernel-hackers-notebook</a> &gt;
    

    
        ev3dev-linux-kernel
    


</div>
<hr />

<p>The bleeding edge upstream development for linux-davinci is hosted at <a href="https://git.kernel.org/cgit/linux/kernel/git/nsekhar/linux-davinci.git">kernel.org</a>.</p>

<p>The ev3dev kernel was originally based on <a href="http://processors.wiki.ti.com/index.php/DaVinci_PSP_03.22.00.02_Release_Notes">Davinci PSP 03.22.00.02</a> from TI.</p>

<h2 id="kernel-drivers">Kernel Drivers</h2>

<p>Most, if not all, of the customization of the ev3dev kernel is the addition and patching of hardware drivers for the EV3 specific hardware. TODO: add more about the ev3dev device driver philosophy - particularly in regard to attributes.</p>

<p>Be sure to check out the <a href="index-2.html#hardware">hardware</a> pages for specifics on how the drivers interface with the hardware.</p>

<h2 id="lms2012-sources">LMS2012 sources</h2>

<p>Most of the EV3 specific drivers are based on the source code for the official LEGO firmware (aka LMS2012). The following table shows the relation of ev3dev drivers to LMS2012 drivers. </p>

<table>
    <tr>
        <th>lms2012</th>
        <th>ev3dev</th>
        <th>Notes</th>
    </tr>
    <tr>
        <td rowspan="3"><a href="../../../../github.com/mindboards/ev3sources/blob/fea79c0e219cd5e43193ce2987b496e04758f3e2/lms2012/d_analog/Linuxmod_AM1808/d_analog.html">d_analog.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/legoev3/legoev3_analog.html">legoev3-analog.c</a></td>
        <td>Device1 portion of d_analog.c</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/legoev3/ev3_input_port.html">ev3_input_port.c</a></td>
        <td>Input portion of Device3</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/ev3dev/ev3dev-kernel/blob/master/drivers/legoev3/ev3_output_port.c">ev3_input_port.c</a></td>
        <td>Output portion of Device3</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_bt/Linuxmod_AM1808/d_bt.html">d_bt.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3dev-kernel/ev3dev-kernel/blob/master/drivers/legoev3/legoev3_bluetooth.html">legoev3_bluetooth.c</a></td>
        <td>
            d_bt.c Device1 is not implemented yet
            <hr />Device2 is for firmware update, so is not needed in ev3dev
            <hr />"slow clock" comes from <a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/extra/linux-03.20.00.13/arch/arm/mach-davinci/board-da850-evm.html">board-da850-evm.c</a> in the lsm2012 kernel
        </td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_iic/Linuxmod_AM1808/d_iic.html">d_iic.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/i2c/busses/i2c-legoev3.html">i2c-legoev3.c</a></td>
        <td>Using standard linux kernel i2c</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_power/Linuxmod_AM1808/d_power.html">d_power.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/power/legoev3_battery.html">legoev3_battery.c</a></td>
        <td>ev3dev power off is done in <a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/arch/arm/mach-davinci/board-_/td_legoev3.html">board-legoev3.c</a></td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_pwm/Linuxmod_AM1808/d_pwm.html">d_pwm.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/legoev3/ev3_tacho_motor.html">ev3_tacho_motor.c</a><br /><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/legoev3/tacho_motor_class.html">tacho_motor_class.c</a></td>
        <td></td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_sound/Linuxmod_AM1808/d_sound.html">d_sound.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/sound/pwm/legoev3.html">legoev3.c</a></td>
        <td>Implemented as a ALSA sound driver for PCM playback and an input device for tone playback</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_uart/Linuxmod_AM1808/d_uart_mod.html">d_uart_mod.c</a></td>
        <td></td>
        <td>Using standard kernel drivers for the SoC UARTs. Ported <a href="https://github.com/mindboards/ev3dev-kernel/tree/master/drivers/tty/serial/omapl_pru">omapl_pru</a> from LEGO firmware for PRU UARTs.</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_ui/Linuxmod_AM1808/d_ui.html">d_ui.c</a></td>
        <td></td>
        <td>Using standard kernel drivers, gpio-keys for buttons and leds-gpio for LEDs</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_usbdev/Linuxmod_AM1808/d_usbdev.html">d_usbdev.c</a></td>
        <td></td>
        <td>Probably won't implement something like this in ev3dev<hr />Using exiting USB gadget drivers</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/lms2012/d_usbhost/Linuxmod_AM1808/d_usbhost.html">d_usbhost.c</a></td>
        <td></td>
        <td>Not implementing because it does not do anything</td>
    </tr>
    <tr>
        <th colspan="3">Kernel</th>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/extra/linux-03.20.00.13/arch/arm/mach-davinci/board-da850-evm.html">board-da850-evm.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/arch/arm/mach-davinci/board-legoev3.html">board-legoev3.c</a></td>
        <td></td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/extra/linux-03.20.00.13/arch/arm/mach-davinci/davinci-iic.html">davinci-iic.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/arch/arm/mach-davinci/legoev3-fiq.html">legoev3-fiq.c</a></td>
        <td>lsm2012 just uses this for i2c, ev3dev uses it for i2c and sound</td>
    </tr>
    <tr>
        <td><a href="../../../../github.com/mindboards/ev3sources/blob/7357369b6ebae4ee62001f3964f0f5fd0cce3c32/extra/linux-03.20.00.13/drivers/video/st7586fb.html">st7586fb.c</a></td>
        <td><a href="../../../../github.com/ev3dev/ev3-kernel/blob/master/drivers/video/st7586fb.html">st7586fb.c</a></td>
        <td></td>
    </tr>
</table>

<h2 id="where-to-find-stuff">Where to find stuff</h2>

<p>Drivers that implement standard kernel interfaces are located in the appropriate place in the kernel tree. Drivers that don’t fit anywhere else are in <code>drivers/legoev3/</code>.</p>

<pre><code>$ tree -P "*legoev3*|ev3_*|nxt_*|ms_*|st7586*" -I "*.o|*.ko|*.mod.c|ms_mg.*|config|debian" --prune
.
├── arch
│   └── arm
│       └── mach-davinci
│           ├── board-legoev3.c
│           ├── board-legoev3.h
│           ├── include
│           │   └── mach
│           │       ├── legoev3-fiq.h
│           │       └── legoev3.h
│           └── legoev3-fiq.c
├── drivers
│   ├── i2c
│   │   └── busses
│   │       └── i2c-legoev3.c
│   ├── legoev3
│   │   ├── ev3_input_port.c
│   │   ├── ev3_touch_sensor.c
│   │   ├── ev3_uart_sensor.c
│   │   ├── legoev3_analog.c
│   │   ├── legoev3_bluetooth.c
│   │   ├── legoev3_ports.c
│   │   ├── legoev3_uart.c
│   │   ├── ms_light_array.c
│   │   ├── nxt_i2c_sensor.c
│   │   ├── nxt_touch_sensor.c
│   │   └── nxt_ultrasonic.c
│   ├── power
│   │   └── legoev3_battery.c
│   └── video
│       └── st7586fb.c
├── include
│   ├── linux
│   │   ├── i2c-algo-legoev3.h
│   │   ├── i2c-legoev3.h
│   │   ├── legoev3
│   │   │   ├── ev3_input_port.h
│   │   │   ├── ev3_output_port.h
│   │   │   ├── legoev3_analog.h
│   │   │   ├── legoev3_bluetooth.h
│   │   │   ├── legoev3_input_port.h
│   │   │   ├── legoev3_ports.h
│   │   │   └── nxt_i2c_sensor.h
│   │   └── power
│   │       └── legoev3_battery.h
│   ├── sound
│   │   └── legoev3.h
│   └── video
│       └── st7586fb.h
└── sound
    └── pwm
        ├── legoev3.c
        └── legoev3.h
</code></pre>

            </div>
        </section>
        <div id="footer">
    <hr class="clear">
    <div class="cclicense">

        <span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">
            www.ev3dev.org (with the exception of the projects pages)
        </span>
        is licensed under
        <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
            <img alt="Creative Commons License" style="border-width:0" src="../../../../licensebuttons.net/l/by-sa/4.0/80x15.png" />
        </a>.
        <br />
        You are free to copy the text and images, but please be courteous and acknowledge the source.

    </div>
    <br />
    <hr class="clear">
    <span class="credits left">
        Project maintained by <a href="https://github.com/rhempel">Ralph Hempel</a>
        and <a href="https://github.com/dlech">David Lechner</a>, with help from the community
    </span>
    <span class="credits right">
        Hosted on GitHub Pages <!--&mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a>-->
    </span>
</div>

    </div>
</body>

<!-- Mirrored from www.ev3dev.org/docs/kernel-hackers-notebook/ev3dev-linux-kernel/index.html by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 01 Jun 2015 09:28:19 GMT -->
</html>
