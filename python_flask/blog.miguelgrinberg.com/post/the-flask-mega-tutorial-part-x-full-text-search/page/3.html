<!DOCTYPE html>
<html>
  
<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search/page/3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 05:51:31 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <title>
    
        The Flask Mega-Tutorial, Part X: Full Text Search - miguelgrinberg.com
    
</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="description" content="miguelgrinberg.com">
	<meta name="copyright" content="Copyright (c) 2012-2015 Miguel Grinberg">
	<meta name="author" content="Miguel Grinberg">
    
    <meta name="keywords" content="python, programming, flask, web, tutorial, database, whoosh, full text search, search">
    

    
    <!-- Bootstrap -->
    <link href="../../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../../../static/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../../../static/colorbox/colorbox.css" rel="stylesheet" type="text/css" />
    <link href="../../../static/style.css" rel="stylesheet" type="text/css" />

    <link rel="shortcut icon" href="../../../static/favicon.ico">
	<link rel="alternate" type="application/rss+xml" href="../../../feed" title="miguelgrinberg.com RSS feed">

  </head>
  <body>
    
    <!-- facebook sdk -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "../../../../connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- google plus sdk -->
    <script type="text/javascript" src="../../../../apis.google.com/js/plusone.js"></script>
    <!-- twitter sdk -->
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="../../../../platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <!-- linkedin sdk -->
    <script src="../../../../platform.linkedin.com/in.js" type="text/javascript"></script>

    
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="http://blog.miguelgrinberg.com/index">Home</a></li>
                        <li><a href="../../about-me.html">About Me</a></li>
                        <li><a href="../../about-this-blog.html">About This Blog</a></li>
                        
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <p class="navbar-text" style="margin-top: 10px; margin-bottom: 0px;">
                                <a type="application/rss+xml" href="../../../feed"><img src="../../../static/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
                                <a href="https://www.facebook.com/miguelgrinbergblog"><img src="../../../static/facebook.png" alt="Facebook" title="Facebook" /></a>
                                <a href="https://plus.google.com/u/0/117786742456929977820"><img src="../../../static/googleplus.png" alt="Google+" title="Google+" /></a>
                                <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../../../static/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
                                <a href="http://github.com/miguelgrinberg"><img src="../../../static/github.png" alt="GitHub" title="GitHub" /></a>
                                <a href="https://twitter.com/#!/miguelgrinberg"><img src="../../../static/twitter.png" alt="Twitter" title="Twitter" /></a>
                            </p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
    </nav>

    
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-md-push-9 sidebar-bg">
                <div id="sidebar">
                    

                    
                    <h1>An Introduction to Flask</h1>
                    <p>If you are a beginner giving your first steps in web development, my Flask introductory video is for you:</p>
                    <p><center><a href="http://bit.ly/flaskintro"><img style="border: 1px solid black;" src="../../../static/flask-intro-cover-tiny.png"></a></center></p>
                    <p>Visit <a href="http://flaskbook.com/">http://flaskbook.com</a> for information about this and other Flask training products I have created!</p>
                    

                    <h1>About Miguel</h1>
                    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../../../static/miguel.jpg" />
                    <p>Welcome to my blog!</p>
                    <p>I'm a software engineer, photographer and filmmaker in Portland, Oregon, USA.</p>
                    <p>You can also find me on <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a>, <a href="https://plus.google.com/u/0/117786742456929977820">Google+</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://github.com/miguelgrinberg">Github</a> and <a href="https://twitter.com/#!/miguelgrinberg">Twitter</a>.</p>
                    <p>Thank you for visiting!</p>

                    

                    
                    <h1>Categories</h1>
<ul>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Arduino/feed">
			<img src="../../../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Arduino">Arduino</a></span> (7)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Authentication/feed">
			<img src="../../../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Authentication">Authentication</a></span> (4)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Blog/feed">
			<img src="../../../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Blog">Blog</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/C++/feed">
			<img src="../../../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/C++">C++</a></span> (5)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Cloud/feed">
			<img src="../../../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Cloud">Cloud</a></span> (2)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Filmmaking/feed">
			<img src="../../../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Filmmaking">Filmmaking</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Flask/feed">
			<img src="../../../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span> (39)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Games/feed">
			<img src="../../../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Games">Games</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Gear/feed">
			<img src="../../../static/rss-small.png" title="Gear RSS Feed" label="Gear RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Gear">Gear</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/HTML5/feed">
			<img src="../../../static/rss-small.png" title="HTML5 RSS Feed" label="HTML5 RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/HTML5">HTML5</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Heroku/feed">
			<img src="../../../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Heroku">Heroku</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Javascript/feed">
			<img src="../../../static/rss-small.png" title="Javascript RSS Feed" label="Javascript RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Javascript">Javascript</a></span> (3)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Movie Reviews/feed">
			<img src="../../../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Movie Reviews">Movie Reviews</a></span> (5)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Netflix/feed">
			<img src="../../../static/rss-small.png" title="Netflix RSS Feed" label="Netflix RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Netflix">Netflix</a></span> (5)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Node.js/feed">
			<img src="../../../static/rss-small.png" title="Node.js RSS Feed" label="Node.js RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../../../category/Node.html">Node.js</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/OpenStack/feed">
			<img src="../../../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/OpenStack">OpenStack</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Personal/feed">
			<img src="../../../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Personal">Personal</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Photography/feed">
			<img src="../../../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Photography">Photography</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Product Reviews/feed">
			<img src="../../../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Product Reviews">Product Reviews</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Programming/feed">
			<img src="../../../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span> (47)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Project Management/feed">
			<img src="../../../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Project Management">Project Management</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Python/feed">
			<img src="../../../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span> (43)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/REST/feed">
			<img src="../../../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/REST">REST</a></span> (5)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Rackspace/feed">
			<img src="../../../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Rackspace">Rackspace</a></span> (1)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Raspberry Pi/feed">
			<img src="../../../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Raspberry Pi">Raspberry Pi</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/RhinoSteady/feed">
			<img src="../../../static/rss-small.png" title="RhinoSteady RSS Feed" label="RhinoSteady RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/RhinoSteady">RhinoSteady</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Robotics/feed">
			<img src="../../../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Robotics">Robotics</a></span> (6)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Video/feed">
			<img src="../../../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Video">Video</a></span> (4)
	</li>

	<li>
		<a href="http://blog.miguelgrinberg.com/category/Windows/feed">
			<img src="../../../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" />
		</a>
		<span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Windows">Windows</a></span> (1)
	</li>

</ul>
                    
                </div>
            </div>
            <div class="col-md-8 col-md-pull-4">
                <div id="main">
                    
                    
                    
                    
                    

<div class="post">

<p class="date"><span class="flask-moment" data-timestamp="2012-11-04T08:00:41Z" data-format="format('LL')" data-refresh="0">2012-11-04T08:00:41Z</span></p>
<h1 class="post-title"><a href="../../the-flask-mega-tutorial-part-x-full-text-search.html">The Flask Mega-Tutorial, Part X: Full Text Search</a></h1>
<div class="posted">Posted by <span class="label label-danger"><a href="http://blog.miguelgrinberg.com/author/Miguel Grinberg">Miguel Grinberg</a></span> under <span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Python">Python</a></span>, <span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Programming">Programming</a></span>, <span class="label label-primary"><a href="http://blog.miguelgrinberg.com/category/Flask">Flask</a></span>. </div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="../../the-flask-mega-tutorial-part-x-full-text-search.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>
<div class="post_body"><p>This is the tenth article in the series in which I document my experience writing web applications in <a href="http://python.org/">Python</a> using the <a href="http://flask.pocoo.org/">Flask</a> microframework.</p>
<p>The goal of the tutorial series is to develop a decently featured microblogging application that demonstrating total lack of originality I have decided to call <code>microblog</code>.</p>
<p><strong>NOTE</strong>: This article was revised in September 2014 to be in sync with current versions of Python and Flask.</p>
<p>Here is an index of all the articles in the series that have been published to date:</p>
<ul>
<li><a href="../../the-flask-mega-tutorial-part-i-hello-world.html">Part I: Hello, World!</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ii-templates.html">Part II: Templates</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iii-web-forms.html">Part III: Web Forms</a></li>
<li><a href="../../the-flask-mega-tutorial-part-iv-database.html">Part IV: Database</a></li>
<li><a href="../../the-flask-mega-tutorial-part-v-user-logins.html">Part V: User Logins</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vi-profile-page-and-avatars.html">Part VI: Profile Page And Avatars</a></li>
<li><a href="../../the-flask-mega-tutorial-part-vii-unit-testing.html">Part VII: Unit Testing</a></li>
<li><a href="../../the-flask-mega-tutorial-part-viii-followers-contacts-and-friends.html">Part VIII: Followers, Contacts And Friends</a></li>
<li><a href="../../the-flask-mega-tutorial-part-ix-pagination.html">Part IX: Pagination</a></li>
<li><a href="../../the-flask-mega-tutorial-part-x-full-text-search.html">Part X: Full Text Search</a> (this article)</li>
<li><a href="../../the-flask-mega-tutorial-part-xi-email-support.html">Part XI: Email Support</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xii-facelift.html">Part XII: Facelift</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiii-dates-and-times.html">Part XIII: Dates and Times</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xiv-i18n-and-l10n.html">Part XIV: I18n and L10n</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xv-ajax.html">Part XV: Ajax</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvi-debugging-testing-and-profiling.html">Part XVI: Debugging, Testing and Profiling</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xvii-deployment-on-linux-even-on-the-raspberry-pi.html">Part XVII: Deployment on Linux (even on the Raspberry Pi!)</a></li>
<li><a href="../../the-flask-mega-tutorial-part-xviii-deployment-on-the-heroku-cloud.html">Part XVIII: Deployment on the Heroku Cloud</a></li>
</ul>
<h2>Recap</h2>
<p>In the <a href="../../the-flask-mega-tutorial-part-ix-pagination.html">previous article</a> in the series we've enhanced our database queries so that we can get results on pages.</p>
<p>Today, we are going to continue working on our database, but in a different area. All applications that store content must provide a search capability.</p>
<p>For many types of web sites it is possible to just let Google, Bing, etc. index all the content and provide the search results. This works well for sites that have mostly static pages, like a forum. In our little <code>microblog</code> application the basic unit of content is just a short user post, not a whole page. The type of search results that we want are dynamic. For example, if we search for the word "dog" we want to see blog posts from any users that include that word. It is obvious that until someone searches for that word there is no page that the big search engines could have indexed with these results, so clearly we have no choice other than rolling our own search.</p>
<h2>Introduction to full text search engines</h2>
<p>Unfortunately support for full text search in relational databases is not well standardized. Each database implements full text search in its own way, and SQLAlchemy at this time does not have a full text search abstration.</p>
<p>We are currently using SQLite for our database, so we could just create a full text index using the facilities provided by SQLite, bypassing SQLAlchemy. But that isn't a good idea, because if one day we decide to switch to another database we would need to rewrite our full text search capability for another database.</p>
<p>So instead, we are going to let our database deal with the regular data, and we are going to create a specialized database that will be dedicated to text searches.</p>
<p>There are a few open source full text search engines. The only one that to my knowledge has a Flask extension is <a href="https://bitbucket.org/mchaput/whoosh/wiki/Home">Whoosh</a>, an engine also written in Python. The advantage of using a pure Python engine is that it will install and run anywhere a Python interpreter is available. The disadvantage is that search performance will not be up to par with other engines that are written in C or C++. In my opinion the ideal solution would be to have a Flask extension that can connect to several engines and abstract us from dealing with a particular one in the same way Flask-SQLAlchemy gives us the freedom to use several database engines, but nothing of that kind seems to be available for full text searching at this time. Django developers do have a very nice extension that supports several full text search engines called <a href="http://haystacksearch.org/">django-haystack</a>. Maybe one day someone will create a similar extension for Flask.</p>
<p>But for now, we'll implement our text searching with Whoosh. The extension that we are going to use is <a href="http://packages.python.org/Flask-WhooshAlchemy">Flask-WhooshAlchemy</a>, which integrates a Whoosh database with Flask-SQLAlchemy models.</p>
<h2>Python 3 Compatibility</h2>
<p>Unfortunately, we have a problem with Python 3 and these packages. The Flask-WhooshAlchemy extension was never made compatible with Python 3. I have forked this extension and made a few changes to make it work, so if you are on Python 3 you will need to uninstall the official version and install my fork:</p>
<pre><code>$ flask/bin/pip uninstall flask-whooshalchemy
$ flask/bin/pip install git+git://github.com/miguelgrinberg/flask-whooshalchemy.git
</code></pre>
<p>Sadly this isn't the only problem. Whoosh also has issues with Python 3, it seems. In my testing I have encontered <a href="https://bitbucket.org/mchaput/whoosh/issue/395/ascii-codec-error-when-performing-query">this bug</a>, and to my knowledge there isn't a solution available, which means that at this time the full text search capability does not work well on Python 3. I will update this section once the issues are resolved.</p>
<h2>Configuration</h2>
<p>Configuration for Flask-WhooshAlchemy is pretty simple. We just need to tell the extension what is the name of the full text search database (file <code>config.py</code>):</p>
<pre><code>WHOOSH_BASE = os.path.join(basedir, 'search.db')
</code></pre>
<h2>Model changes</h2>
<p>Since Flask-WhooshAlchemy integrates with Flask-SQLAlchemy, we indicate what data is to be indexed for searching in the proper model class (file <code>app/models.py</code>):</p>
<pre><code>from app import app

import sys
if sys.version_info &gt;= (3, 0):
    enable_search = False
else:
    enable_search = True
    import flask.ext.whooshalchemy as whooshalchemy

class Post(db.Model):
    __searchable__ = ['body']

    id = db.Column(db.Integer, primary_key=True)
    body = db.Column(db.String(140))
    timestamp = db.Column(db.DateTime)
    user_id = db.Column(db.Integer, db.ForeignKey('user.id'))

    def __repr__(self):
        return '&lt;Post %r&gt;' % (self.body)

if enable_search:
    whooshalchemy.whoosh_index(app, Post)
</code></pre>
<p>The model has a new <code>__searchable__</code> field, which is an array with all the database fields that will be in the searchable index. In our case we only want to index the body field of our posts.</p>
<p>We also have to initialize the full text index for this model by calling the <code>whoosh_index</code> function. Note that since we know that the search capability currently does not work on Python 3 we have to skip its initialization. Once the problems in Whoosh are fixed the logic around <code>enable_search</code> can be removed.</p>
<p>Since this isn't a change that affects the format of our relational database we do not need to record a new migration.</p>
<p>Unfortunately any posts that were in the database before the full text engine was added will not be indexed. To make sure the database and the full text engine are synchronized we are going to delete all posts from the database and start over. First we start the Python interpreter. For Windows users:</p>
<pre><code>flask\Scripts\python
</code></pre>
<p>And for everyone else:</p>
<pre><code>flask/bin/python
</code></pre>
<p>Then in the Python prompt we delete all the posts:</p>
<pre><code>&gt;&gt;&gt; from app.models import Post
&gt;&gt;&gt; from app import db
&gt;&gt;&gt; for post in Post.query.all():
...    db.session.delete(post)
&gt;&gt;&gt; db.session.commit()
</code></pre>
<h2>Searching</h2>
<p>And now we are ready to start searching. First let's add a few new posts to the database. We have two options to do this. We can just start the application and enter posts via the web browser, as regular users would do, or we can also do it in the Python prompt.</p>
<p>From the Python prompt we can do it as follows:</p>
<pre><code>&gt;&gt;&gt; from app.models import User, Post
&gt;&gt;&gt; from app import db
&gt;&gt;&gt; import datetime
&gt;&gt;&gt; u = User.query.get(1)
&gt;&gt;&gt; p = Post(body='my first post', timestamp=datetime.datetime.utcnow(), author=u)
&gt;&gt;&gt; db.session.add(p)
&gt;&gt;&gt; p = Post(body='my second post', timestamp=datetime.datetime.utcnow(), author=u)
&gt;&gt;&gt; db.session.add(p)
&gt;&gt;&gt; p = Post(body='my third and last post', timestamp=datetime.datetime.utcnow(), author=u)
&gt;&gt;&gt; db.session.add(p)
&gt;&gt;&gt; db.session.commit()
</code></pre>
<p>The Flask-WhooshAlchemy extension is nice, because it hooks up into Flask-SQLAlchemy commits automatically. We do not need to maintain the full text index, it is all done for us transparently.</p>
<p>Now that we have a few posts in our full text index we can issue searches:</p>
<pre><code>&gt;&gt;&gt; Post.query.whoosh_search('post').all()
[&lt;Post u'my second post'&gt;, &lt;Post u'my first post'&gt;, &lt;Post u'my third and last post'&gt;]
&gt;&gt;&gt; Post.query.whoosh_search('second').all()
[&lt;Post u'my second post'&gt;]
&gt;&gt;&gt; Post.query.whoosh_search('second OR last').all()
[&lt;Post u'my second post'&gt;, &lt;Post u'my third and last post'&gt;]
</code></pre>
<p>As you can see in the examples above, the queries do not need to be limited to single words. In fact, Whoosh supports a pretty powerful <a href="http://packages.python.org/Whoosh/querylang.html">search query language</a>.</p>
<h2>Integrating full text searches into the application</h2>
<p>To make the searching capability available to our application's users we have to add just a few small changes.</p>
<h3>Configuration</h3>
<p>As far as configuration, we'll just indicate how many search results should be returned as a maximum (file <code>config.py</code>):</p>
<pre><code>MAX_SEARCH_RESULTS = 50
</code></pre>
<h3>Search form</h3>
<p>We are going to add a search form to the navigation bar at the top of the page. Putting the search box at the top is nice, because then the search will be accessible from all pages.</p>
<p>First we add a search form class (file <code>app/forms.py</code>):</p>
<pre><code>class SearchForm(Form):
    search = StringField('search', validators=[DataRequired()])
</code></pre>
<p>Then we need to create a search form object and make it available to all templates, since we will be putting the search form in the navigation bar that is common to all pages. The easiest way to achieve this is to create the form in the <code>before_request</code> handler, and then stick it in Flask's global <code>g</code> (file <code>app/views.py</code>):</p>
<pre><code>from forms import SearchForm

@app.before_request
def before_request():
    g.user = current_user
    if g.user.is_authenticated():
        g.user.last_seen = datetime.utcnow()
        db.session.add(g.user)
        db.session.commit()
        g.search_form = SearchForm()
</code></pre>
<p>Then we add the form to our template (file <code>app/templates/base.html</code>):</p>
<pre><code>&lt;div&gt;Microblog:
    &lt;a href="{{ url_for('index') }}"&gt;Home&lt;/a&gt;
    {% if g.user.is_authenticated() %}
    | &lt;a href="{{ url_for('user', nickname=g.user.nickname) }}"&gt;Your Profile&lt;/a&gt;
    | &lt;form style="display: inline;" action="{{ url_for('search') }}" method="post" name="search"&gt;{{ g.search_form.hidden_tag() }}{{ g.search_form.search(size=20) }}&lt;input type="submit" value="Search"&gt;&lt;/form&gt;
    | &lt;a href="{{ url_for('logout') }}"&gt;Logout&lt;/a&gt;
    {% endif %}
&lt;/div&gt;
</code></pre>
<p>Note that we only display the form when we have a logged in user. Likewise, the <code>before_request</code> handler will only create a form when a user is logged in, since our application does not show any content to guests that are not authenticated.</p>
<h3>Search view function</h3>
<p>The <code>action</code> field of our form was set above to send all search requests the the <code>search</code> view function. This is where we will be issuing our full text queries (file <code>app/views.py</code>):</p>
<pre><code>@app.route('/search', methods=['POST'])
@login_required
def search():
    if not g.search_form.validate_on_submit():
        return redirect(url_for('index'))
    return redirect(url_for('search_results', query=g.search_form.search.data))
</code></pre>
<p>This function doesn't really do much, it just collects the search query from the form and then redirects to another page passing this query as an argument. The reason the search work isn't done directly here is that if a user then hits the refresh button the browser will put up a warning indicating that form data will be resubmitted. This is avoided when the response to a POST request is a redirect, because after the redirect the browser's refresh button will reload the redirected page.</p>
<h2>Search results page</h2>
<p>Once a query string has been received the form POST handler sends it via page redirection to the <code>search_results</code> handler (file <code>app/views.py</code>):</p>
<pre><code>from config import MAX_SEARCH_RESULTS

@app.route('/search_results/&lt;query&gt;')
@login_required
def search_results(query):
    results = Post.query.whoosh_search(query, MAX_SEARCH_RESULTS).all()
    return render_template('search_results.html',
                           query=query,
                           results=results)
</code></pre>
<p>The search results view function sends the query into Whoosh, passing a maximum number of search results, since we don't want to be presenting a potentially large number of hits, we are happy showing just the first fifty.</p>
<p>The final piece is the search results template (file <code>app/templates/search_results.html</code>):</p>
<pre><code>&lt;!-- extend base layout --&gt;
{% extends "base.html" %}

{% block content %}
  &lt;h1&gt;Search results for "{{ query }}":&lt;/h1&gt;
  {% for post in results %}
      {% include 'post.html' %}
  {% endfor %}
{% endblock %}
</code></pre>
<p>And here, once again, we can reuse our <code>post.html</code> sub-template, so we don't need to worry about rendering avatars or other formatting elements, since all of that is done in a generic way in the sub-template.</p>
<h2>Final words</h2>
<p>We now have completed yet another important, though often overlooked piece that any decent web application must have.</p>
<p>The source code for the updated <code>microblog</code> application is available below:</p>
<p>Download <a href="https://codeload.github.com/miguelgrinberg/microblog/zip/version-0.10">microblog-0.10.zip</a>.</p>
<p>As always, the above download does not include a database or a flask virtual environment. See previous articles in the series to learn how to create these.</p>
<p>I hope you enjoyed this tutorial. If you have any questions feel free to write in the comments below. Thank you for reading, and I will be seeing you again in the next installment!</p>
<p>Miguel</p></div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="../../the-flask-mega-tutorial-part-x-full-text-search.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>


<h4 style="text-align: right"><a name="comments"></a>87 comments</h4>


<div class="comment">
    <ul>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/0bab3a3e1a3625c3e9db43f8b2f7924cce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#51</span> <span class="label label-primary"><a href="http://invernalia.homelinux.net/jstitch">Javier</a></span> said
                    <span class="flask-moment" data-timestamp="2014-09-25T00:20:28Z" data-format="fromNow(0)" data-refresh="0">2014-09-25T00:20:28Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Very old post, hope I&#39;m not resurrecting an old issue...

I&#39;m sure I&#39;m using Flash-WhooshAlchemy 0.55a , but I stumble with the problem that the query from the search form is a dictionary. That is, g.search_form.data throws a dictionary {&#39;search&#39;: &#39;my sample query...&#39;}

So at the views.search method I have to first read the &#39;search&#39; key and send that as the query to the search_results method. That makes totally sense, but can&#39;t seem anything related about that on your text.

Any ideas why this behaviour I&#39;m having differs from what you wrote?


BTW very great set of  tutorials!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#52</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-09-26T14:12:29Z" data-format="fromNow(0)" data-refresh="0">2014-09-26T14:12:29Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Javier: try g.search_form.search.data. When you do g.search_form.data you are getting the data for all the fields in a dictionary.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/21e08b5ff0801febc7bc4813f155dcc5ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#53</span> <span class="label label-primary">UrduD</span> said
                    <span class="flask-moment" data-timestamp="2014-10-21T08:07:17Z" data-format="fromNow(0)" data-refresh="0">2014-10-21T08:07:17Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel, Thank you very much for taking time to put thois tutorial up. I would not be using FTS if it were not for this article.
I see that whoosh alchemy seems to be a good but disappointing chioce for a beginner like me. Not much examples or documentation to be found.
Please help - Can I use whoosh directly as I want to use analysis functionality of whhosh to do fuzzy search of unicode words. Each column has a single word. Two such columns have been adding to __searchable__. Thanks again.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#54</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-22T06:27:08Z" data-format="fromNow(0)" data-refresh="0">2014-10-22T06:27:08Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@UrduD: you can certainly use Whoosh directly if you prefer that, but then you cannot take advantage of the integration with SQLAlchemy models, as that is done by Flask-WhooshAlchemy. If you go with Whoosh alone you will need to maintain the indexes yourself.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/21e08b5ff0801febc7bc4813f155dcc5ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#55</span> <span class="label label-primary">UrduD</span> said
                    <span class="flask-moment" data-timestamp="2014-10-22T20:08:05Z" data-format="fromNow(0)" data-refresh="0">2014-10-22T20:08:05Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thanks Miguel. I liked Flask-WhooshAlchemy for reasons you mentioned. Is there a way to get to whoosh&#39;s QueryParser &amp; searcher objects while using Flask-WhooshAlchemy? Excuse me for being a beginner yet looking for advanced features.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#56</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-22T21:18:31Z" data-format="fromNow(0)" data-refresh="0">2014-10-22T21:18:31Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@UrduD: have you read the Flask-WhooshAlchemy source code? The extension is pretty short, my recommendation is that you take the code and modify it to your needs.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/6509f6b988ca61dfa489f3e1dd5ea4cfce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#57</span> <span class="label label-primary">Aaron</span> said
                    <span class="flask-moment" data-timestamp="2014-10-24T18:59:51Z" data-format="fromNow(0)" data-refresh="0">2014-10-24T18:59:51Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">There&#39;s an error in the code about using git to instal your version of whoosh when using Python 3. Right now you have &#34;flask/bin/pip git+git://github.com/miguelgrinberg/flask-whooshalchemy.git&#34; but it should be &#34;flask/bin/pip install git+git://github.com/miguelgrinberg/flask-whooshalchemy.git&#34;.

(The error is that it&#39;s missing the &#34;install&#34; command before the path to the git repo.)</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#58</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-25T17:32:17Z" data-format="fromNow(0)" data-refresh="0">2014-10-25T17:32:17Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Aaron: thanks, I updated the article.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/e7355312b5afb5a57d6d826c6303e353ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#59</span> <span class="label label-primary"><a href="ronn-bundgaard.html">Martin</a></span> said
                    <span class="flask-moment" data-timestamp="2014-10-27T09:09:40Z" data-format="fromNow(0)" data-refresh="0">2014-10-27T09:09:40Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi, thanks for the awesome tutorials and book. It has been great help for learning Flask. I just wanted to let you know that using your version of flask-whooshalchemy and Whoosh 2.6.0 on python 3.4.1 works perfectly :).  </p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/6852f768a68455f674598a97856f18dbce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#60</span> <span class="label label-primary">Sean</span> said
                    <span class="flask-moment" data-timestamp="2014-11-03T16:22:05Z" data-format="fromNow(0)" data-refresh="0">2014-11-03T16:22:05Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I can&#39;t for the life of me work out why this doesn&#39;t work, when I try to search for something, I am presented with this:

AttributeError: &#39;BaseQuery&#39; object has no attribute &#39;whoosh_search&#39;

I have gone through the tutorial word for word, and thus far been able to fix (with a lot of effort, pesky typos) a lot of the errors I have encountered. This one has completely stumped me, though.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#61</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-03T17:31:17Z" data-format="fromNow(0)" data-refresh="0">2014-11-03T17:31:17Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Sean: my guess is that you did not call whooshalchemy.whoosh_index(app, Post) at the bottom of models.py. Compare your source file with mine on GitHub to make sure they look the same.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/6852f768a68455f674598a97856f18dbce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#62</span> <span class="label label-primary">Sean</span> said
                    <span class="flask-moment" data-timestamp="2014-11-03T19:17:44Z" data-format="fromNow(0)" data-refresh="0">2014-11-03T19:17:44Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hmm. I already have that line. I&#39;ll come back to it with fresh eyes, but I have compared yours on GitHub, or as best I could given that I haven&#39;t completed the tutorial yet. So I didn&#39;t want to add in code I have yet to come across.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/6852f768a68455f674598a97856f18dbce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#63</span> <span class="label label-primary">Sean</span> said
                    <span class="flask-moment" data-timestamp="2014-11-04T11:13:45Z" data-format="fromNow(0)" data-refresh="0">2014-11-04T11:13:45Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Might I point out, that before adding it to the template, I got the same error via the interpreter:

&gt;&gt; Post.query.whoosh_search(&#39;post&#39;).all()
Traceback (most recent call last):
   File &#34;&lt;stdin&gt;&#34;, line 1, in &lt;module&gt;
AttributeError: &#39;BaseQuery&#39; object has no attribute &#39;whoosh_search&#39;

Any other possible ideas you might have would be helpful.
</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#64</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-05T02:36:47Z" data-format="fromNow(0)" data-refresh="0">2014-11-05T02:36:47Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Sean: in the console, try:

&gt;&gt;&gt; import flask.ext.whooshalchemy as whooshalchemy
&gt;&gt;&gt; from app import app
&gt;&gt;&gt; from app.models import Post
&gt;&gt;&gt; whooshalchemy.whoosh_index(app, Post)
&gt;&gt;&gt; Post.query.whoosh_search(&#39;post&#39;).all()

Does it work this way?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/13ba51326d6730418de1643dacbbf1bdce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#65</span> <span class="label label-primary">Dmitry</span> said
                    <span class="flask-moment" data-timestamp="2014-11-13T11:15:13Z" data-format="fromNow(0)" data-refresh="0">2014-11-13T11:15:13Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Is it possible to paginate search results?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#66</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-14T18:29:10Z" data-format="fromNow(0)" data-refresh="0">2014-11-14T18:29:10Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Dmitry: the flask-whooshalchemy extension does not do pagination at this time, it only takes a &#34;limit&#34; argument to specify how many results to return.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/050ae0ed6f7fa82b40e8672ea26b43c3ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#67</span> <span class="label label-primary">Ramchandra Apte</span> said
                    <span class="flask-moment" data-timestamp="2014-11-15T16:50:45Z" data-format="fromNow(0)" data-refresh="0">2014-11-15T16:50:45Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">This tutorial really helped with integrating Whoosh into my website. Thanks!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/bdc9b698435cb9835104295416a28743ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#68</span> <span class="label label-primary">Bueno</span> said
                    <span class="flask-moment" data-timestamp="2014-12-05T00:52:57Z" data-format="fromNow(0)" data-refresh="0">2014-12-05T00:52:57Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Miguel, you are doing an incredible job with these posts, thank you

I had the same problem as @Sean in comment #60
AttributeError: &#39;BaseQuery&#39; object has no attribute &#39;whoosh_search&#39;

This occurs because the IF that check the python version in file models.py doesn&#39;t get in else condition when i use python version 2. This way, the &#39;whooshalchemy&#39; is not imported and the line whooshalchemy.whoosh_index(app, Post) does not executed because the flag enable_search is False

If you change the line
if sys.version_info &gt;= (3.0): 
for 
if sys.version_info.major &gt;= 3:
all the things works</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/9ff57504460ae90e23608b1d0cc74a31ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#69</span> <span class="label label-primary">Vivian</span> said
                    <span class="flask-moment" data-timestamp="2014-12-06T22:38:15Z" data-format="fromNow(0)" data-refresh="0">2014-12-06T22:38:15Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel! 

I followed this tutorial to do something similar. I want create a search engine that takes in 3 fields and searches a table for a tuple that matches those 3 fields. In my case they&#39;re called state, city, and activity. I&#39;ve gotten the forms, the models, views etc written out, but the issue I&#39;m having is how to pass the form information state city and activity from the search method to the search_result method. Should I store state, city, and activity in a list called query, then in the search.html form, have my computer somehow store the list query in /search_results/&lt;query&gt;? I don&#39;t know if this is the best way to go about multiple attribute searching, so if you have any advice that&#39;d be great.

Thanks so much! 
Vivian</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#70</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-12-07T01:29:45Z" data-format="fromNow(0)" data-refresh="0">2014-12-07T01:29:45Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Vivian: you can code your search_result method with multiple arguments. For example, you can use a route like this: &#34;/search_results/&lt;state&gt;/&lt;city&gt;/&lt;activity&gt;&#34;. Another option is to pass these three values as query string arguments, so then your route is &#34;/search_results&#34; and you get the three values from request.args. In this case your URL would look like this, for example: &#34;/search_results?state=OR&amp;city=Portland&amp;activity=run&#34;.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/727e737ddb264dcf2c32fc77bea0a904ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#71</span> <span class="label label-primary">John</span> said
                    <span class="flask-moment" data-timestamp="2014-12-12T22:25:47Z" data-format="fromNow(0)" data-refresh="0">2014-12-12T22:25:47Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Is there an equivalent of Whoosh for NoSQL? </p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/e012a506d53b1c1166889f1ecef2818bce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#72</span> <span class="label label-primary">Taylor</span> said
                    <span class="flask-moment" data-timestamp="2015-01-14T23:42:04Z" data-format="fromNow(0)" data-refresh="0">2015-01-14T23:42:04Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel,

I&#39;m trying to index two tables - a Client table and a Condo table. However, when I run whoosh_index() on each of these in turn, I only get indexed results for the table I indexed last. The relevant code is here in a bug report: https://github.com/gyllstromk/Flask-WhooshAlchemy/issues/29

Any idea how to index multiple tables? Am I missing something here?

Thanks!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#73</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2015-01-15T18:18:45Z" data-format="fromNow(0)" data-refresh="0">2015-01-15T18:18:45Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Taylor: I haven&#39;t tried to index more than one table, but briefly looking at the code of the extension it appears to be fully in support of that. My recommendation is that you debug insertions, to make sure that any time you insert a record in your tables whoosh is invoked to do the same. If you run with a debugger, you can put a breakpoint in the _after_flush() function, which the extension sets as a callback with sqlalchemy. If you don&#39;t normally use a debugger, I recommend that you use pudb.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/727e737ddb264dcf2c32fc77bea0a904ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#74</span> <span class="label label-primary"><a href="None-2.html">John Lin</a></span> said
                    <span class="flask-moment" data-timestamp="2015-01-19T00:57:19Z" data-format="fromNow(0)" data-refresh="0">2015-01-19T00:57:19Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel, 

Thanks for the post and answering my other questions. I have recently changed my database to have post_text be post_text1 (and I also have a 2 and 3). Anyways, I am getting the following error: 

&#34;% (name, schema))
UnknownFieldError: No field named &#39;post_text1&#39; in &lt;Schema: [&#39;id&#39;, &#39;post_text&#39;]&gt;&#34;

It seems to be hanging on to my old name for column rather than using a new one. How do I resolve this? 

</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#75</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2015-01-19T01:39:13Z" data-format="fromNow(0)" data-refresh="0">2015-01-19T01:39:13Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@John: did you create a database migration for your change?</p>
                </div>
            </div>
        </li>
        
    </ul>
</div>

<div class="page">
<ul class="pager">
  <li class="previous">
    <a href="1.html#comments">&laquo;&laquo;</a>
  </li>
  <li class="previous">
    <a href="2.html#comments">&laquo;</a>
  </li>
  <li class="next">
    <a href="0.html#comments">&raquo;&raquo;</a>
  </li>
  <li class="next">
    <a href="4.html#comments">&raquo;</a>
  </li>
</ul>
</div>

<h3><a name="commentform"></a>Leave a Comment</h3>

<form action="#commentform" method="post"
  class="form" role="form">
  <div style="display:none;"><input id="csrf_token" name="csrf_token" type="hidden" value="1439534991.83##e6c6b0e8757a6850b598e20657f8d4f30e68bc98"></div>
  
    
    






<div class="form-group "><label class="control-label" for="name">Name</label>
        <input class="form-control" id="name" name="name" required type="text" value="">
  </div>


    




<div class="form-group "><label class="control-label" for="url">URL</label>
        <input class="form-control" id="url" name="url" type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="email">Email</label>
        <input class="form-control" id="email" name="email" required type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="comment">Comment</label>
        <textarea class="form-control" id="comment" name="comment" required></textarea>
  </div>


    




<div class="form-group "><label class="control-label" for="captcha">Captcha</label>
        
<script type="text/javascript">var RecaptchaOptions = {"custom_translations": {"audio_challenge": "Get an audio challenge", "cant_hear_this": "Download sound as MP3", "help_btn": "Help", "image_alt_text": "reCAPTCHA challenge image", "incorrect_try_again": "Incorrect. Try again.", "instructions_audio": "Type what you hear", "instructions_visual": "Type the text", "play_again": "Play sound again", "privacy_and_terms": "Privacy & Terms", "refresh_btn": "Get a new challenge", "visual_challenge": "Get a visual challenge"}, "theme": "white"};</script>
<script type="text/javascript" src="http://www.google.com/recaptcha/api/challenge?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></script>
<noscript>
  <iframe src="http://www.google.com/recaptcha/api/noscript?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S" height="300" width="500" frameborder="0"></iframe><br>
  <textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
  <input type="hidden" name="recaptcha_response_field" value="manual_challenge">
</noscript>

  </div>


    





  


    <input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">
  





</form>


</div>

                </div>
            </div>
        </div>
        <div id="footer">
            <p class="elapsed">This page was generated in None seconds.</p>
            <p>&copy; 2014 by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
        </div>
    </div>


    
    
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../../../cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js"></script>
    <script type="text/javascript" src="../../../static/prettify.js"></script>
    <script src="../../../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment-with-langs.min.js"></script>
<script>
function flask_moment_render(elem) {
    $(elem).text(eval('moment("' + $(elem).data('timestamp') + '").' + $(elem).data('format') + ';'));
    $(elem).removeClass('flask-moment');
}
function flask_moment_render_all() {
    $('.flask-moment').each(function() {
        flask_moment_render(this);
        if ($(this).data('refresh')) {
            (function(elem, interval) { setInterval(function() { flask_moment_render(elem) }, interval); })(this, $(this).data('refresh'));
        }
    })
}
$(document).ready(function() {
    flask_moment_render_all();
});
</script>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4777284-15']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            $(".gallery").colorbox({rel:".gallery",maxWidth:"95%",maxHeight:"95%",scalePhotos:true});
            // add prettyprint class to all <pre><code></code></pre> blocks
            var prettify = false;
            $("pre code").parent().each(function() {
                $(this).addClass('prettyprint');
                prettify = true;
            });
            prettyPrint();
        });
    </script>


  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/the-flask-mega-tutorial-part-x-full-text-search/page/3 by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 05:51:40 GMT -->
</html>
