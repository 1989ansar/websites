<!DOCTYPE html>
<html>
  
<!-- Mirrored from blog.miguelgrinberg.com/post/video-streaming-with-flask by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 06:45:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    
    <title>
    
        Video Streaming with Flask - miguelgrinberg.com
    
</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta name="description" content="miguelgrinberg.com">
	<meta name="copyright" content="Copyright (c) 2012-2015 Miguel Grinberg">
	<meta name="author" content="Miguel Grinberg">
    
    <meta name="keywords" content="python, programming, flask, streaming, webcam, video, raspberry pi">
    

    
    <!-- Bootstrap -->
    <link href="../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="../static/prettify.css" type="text/css" rel="stylesheet" />
    <link href="../static/colorbox/colorbox.css" rel="stylesheet" type="text/css" />
    <link href="../static/style.css" rel="stylesheet" type="text/css" />

    <link rel="shortcut icon" href="../static/favicon.ico">
	<link rel="alternate" type="application/rss+xml" href="../feed" title="miguelgrinberg.com RSS feed">

  </head>
  <body>
    
    <!-- facebook sdk -->
    <div id="fb-root"></div>
    <script>(function(d, s, id) {
      var js, fjs = d.getElementsByTagName(s)[0];
      if (d.getElementById(id)) return;
      js = d.createElement(s); js.id = id;
      js.src = "../../connect.facebook.net/en_US/all.js#xfbml=1";
      fjs.parentNode.insertBefore(js, fjs);
    }(document, 'script', 'facebook-jssdk'));</script>
    <!-- google plus sdk -->
    <script type="text/javascript" src="../../apis.google.com/js/plusone.js"></script>
    <!-- twitter sdk -->
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="../../platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
    <!-- linkedin sdk -->
    <script src="../../platform.linkedin.com/in.js" type="text/javascript"></script>

    
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="http://blog.miguelgrinberg.com/index">miguelgrinberg.com</a>
                </div>
                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li><a href="http://blog.miguelgrinberg.com/index">Home</a></li>
                        <li><a href="about-me.html">About Me</a></li>
                        <li><a href="about-this-blog.html">About This Blog</a></li>
                        
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <p class="navbar-text" style="margin-top: 10px; margin-bottom: 0px;">
                                <a type="application/rss+xml" href="../feed"><img src="../static/rss.png" alt="RSS Feed" title="RSS Feed" /></a>
                                <a href="https://www.facebook.com/miguelgrinbergblog"><img src="../static/facebook.png" alt="Facebook" title="Facebook" /></a>
                                <a href="https://plus.google.com/u/0/117786742456929977820"><img src="../static/googleplus.png" alt="Google+" title="Google+" /></a>
                                <a href="http://www.linkedin.com/in/miguelgrinberg"><img src="../static/linkedin.png" alt="LinkedIn" title="LinkedIn" /></a>
                                <a href="http://github.com/miguelgrinberg"><img src="../static/github.png" alt="GitHub" title="GitHub" /></a>
                                <a href="https://twitter.com/#!/miguelgrinberg"><img src="../static/twitter.png" alt="Twitter" title="Twitter" /></a>
                            </p>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
    </nav>

    
    <div class="container">
        <div class="row">
            <div class="col-md-4 col-md-push-9 sidebar-bg">
                <div id="sidebar">
                    

                    
                    <h1>Building Web APIs with Flask</h1>
                    <p>Flask is the ideal Python framework for building REST APIs that are flexible, easy to maintain and efficient. I have created a training video with O'Reilly in which I show all my techniques:</p>
                    <p><center><a href="http://bit.ly/flaskapi"><img style="border: 1px solid black;" src="../static/flask-api-cover-tiny.png"></a></center></p>
                    <p>Visit <a href="http://flaskbook.com/">http://flaskbook.com</a> for information about this and other Flask training products I have created!</p>
                    

                    <h1>About Miguel</h1>
                    <img style="float: right; margin: 0px 8px 8px 0px; padding: 4px; border: 1px solid #ccc;" src="../static/miguel.jpg" />
                    <p>Welcome to my blog!</p>
                    <p>I'm a software engineer, photographer and filmmaker in Portland, Oregon, USA.</p>
                    <p>You can also find me on <a href="https://www.facebook.com/miguelgrinbergblog">Facebook</a>, <a href="https://plus.google.com/u/0/117786742456929977820">Google+</a>, <a href="http://www.linkedin.com/in/miguelgrinberg">LinkedIn</a>, <a href="https://github.com/miguelgrinberg">Github</a> and <a href="https://twitter.com/#!/miguelgrinberg">Twitter</a>.</p>
                    <p>Thank you for visiting!</p>

                    

                    
                    <h1>Categories</h1>
<ul>

	<li>
		<a href="../category/Arduino/feed">
			<img src="../static/rss-small.png" title="Arduino RSS Feed" label="Arduino RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Arduino.html">Arduino</a></span> (7)
	</li>

	<li>
		<a href="../category/Authentication/feed">
			<img src="../static/rss-small.png" title="Authentication RSS Feed" label="Authentication RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Authentication.html">Authentication</a></span> (4)
	</li>

	<li>
		<a href="../category/Blog/feed">
			<img src="../static/rss-small.png" title="Blog RSS Feed" label="Blog RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Blog.html">Blog</a></span> (1)
	</li>

	<li>
		<a href="../category/C%2b%2b/feed">
			<img src="../static/rss-small.png" title="C++ RSS Feed" label="C++ RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/C%2b%2b.html">C++</a></span> (5)
	</li>

	<li>
		<a href="../category/Cloud/feed">
			<img src="../static/rss-small.png" title="Cloud RSS Feed" label="Cloud RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Cloud.html">Cloud</a></span> (2)
	</li>

	<li>
		<a href="../category/Filmmaking/feed">
			<img src="../static/rss-small.png" title="Filmmaking RSS Feed" label="Filmmaking RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Filmmaking.html">Filmmaking</a></span> (6)
	</li>

	<li>
		<a href="../category/Flask/feed">
			<img src="../static/rss-small.png" title="Flask RSS Feed" label="Flask RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Flask.html">Flask</a></span> (39)
	</li>

	<li>
		<a href="../category/Games/feed">
			<img src="../static/rss-small.png" title="Games RSS Feed" label="Games RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Games.html">Games</a></span> (1)
	</li>

	<li>
		<a href="../category/Gear/feed">
			<img src="../static/rss-small.png" title="Gear RSS Feed" label="Gear RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Gear.html">Gear</a></span> (6)
	</li>

	<li>
		<a href="../category/HTML5/feed">
			<img src="../static/rss-small.png" title="HTML5 RSS Feed" label="HTML5 RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/HTML5.html">HTML5</a></span> (1)
	</li>

	<li>
		<a href="../category/Heroku/feed">
			<img src="../static/rss-small.png" title="Heroku RSS Feed" label="Heroku RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Heroku.html">Heroku</a></span> (1)
	</li>

	<li>
		<a href="../category/Javascript/feed">
			<img src="../static/rss-small.png" title="Javascript RSS Feed" label="Javascript RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Javascript.html">Javascript</a></span> (3)
	</li>

	<li>
		<a href="../category/Movie%20Reviews/feed">
			<img src="../static/rss-small.png" title="Movie Reviews RSS Feed" label="Movie Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Movie%20Reviews.html">Movie Reviews</a></span> (5)
	</li>

	<li>
		<a href="../category/Netflix/feed">
			<img src="../static/rss-small.png" title="Netflix RSS Feed" label="Netflix RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Netflix.html">Netflix</a></span> (5)
	</li>

	<li>
		<a href="../category/Node.js/feed">
			<img src="../static/rss-small.png" title="Node.js RSS Feed" label="Node.js RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Node.html">Node.js</a></span> (1)
	</li>

	<li>
		<a href="../category/OpenStack/feed">
			<img src="../static/rss-small.png" title="OpenStack RSS Feed" label="OpenStack RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/OpenStack.html">OpenStack</a></span> (1)
	</li>

	<li>
		<a href="../category/Personal/feed">
			<img src="../static/rss-small.png" title="Personal RSS Feed" label="Personal RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Personal.html">Personal</a></span> (1)
	</li>

	<li>
		<a href="../category/Photography/feed">
			<img src="../static/rss-small.png" title="Photography RSS Feed" label="Photography RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Photography.html">Photography</a></span> (6)
	</li>

	<li>
		<a href="../category/Product%20Reviews/feed">
			<img src="../static/rss-small.png" title="Product Reviews RSS Feed" label="Product Reviews RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Product%20Reviews.html">Product Reviews</a></span> (1)
	</li>

	<li>
		<a href="../category/Programming/feed">
			<img src="../static/rss-small.png" title="Programming RSS Feed" label="Programming RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Programming.html">Programming</a></span> (47)
	</li>

	<li>
		<a href="../category/Project%20Management/feed">
			<img src="../static/rss-small.png" title="Project Management RSS Feed" label="Project Management RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Project%20Management.html">Project Management</a></span> (1)
	</li>

	<li>
		<a href="../category/Python/feed">
			<img src="../static/rss-small.png" title="Python RSS Feed" label="Python RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Python.html">Python</a></span> (43)
	</li>

	<li>
		<a href="../category/REST/feed">
			<img src="../static/rss-small.png" title="REST RSS Feed" label="REST RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/REST.html">REST</a></span> (5)
	</li>

	<li>
		<a href="../category/Rackspace/feed">
			<img src="../static/rss-small.png" title="Rackspace RSS Feed" label="Rackspace RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Rackspace.html">Rackspace</a></span> (1)
	</li>

	<li>
		<a href="../category/Raspberry%20Pi/feed">
			<img src="../static/rss-small.png" title="Raspberry Pi RSS Feed" label="Raspberry Pi RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Raspberry%20Pi.html">Raspberry Pi</a></span> (6)
	</li>

	<li>
		<a href="../category/RhinoSteady/feed">
			<img src="../static/rss-small.png" title="RhinoSteady RSS Feed" label="RhinoSteady RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/RhinoSteady.html">RhinoSteady</a></span> (6)
	</li>

	<li>
		<a href="../category/Robotics/feed">
			<img src="../static/rss-small.png" title="Robotics RSS Feed" label="Robotics RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Robotics.html">Robotics</a></span> (6)
	</li>

	<li>
		<a href="../category/Video/feed">
			<img src="../static/rss-small.png" title="Video RSS Feed" label="Video RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Video.html">Video</a></span> (4)
	</li>

	<li>
		<a href="../category/Windows/feed">
			<img src="../static/rss-small.png" title="Windows RSS Feed" label="Windows RSS Feed" />
		</a>
		<span class="label label-primary"><a href="../category/Windows.html">Windows</a></span> (1)
	</li>

</ul>
                    
                </div>
            </div>
            <div class="col-md-8 col-md-pull-4">
                <div id="main">
                    
                    
                    
                    
                    

<div class="post">

<p class="date"><span class="flask-moment" data-timestamp="2014-10-20T04:02:03Z" data-format="format('LL')" data-refresh="0">2014-10-20T04:02:03Z</span></p>
<h1 class="post-title"><a href="video-streaming-with-flask.html">Video Streaming with Flask</a></h1>
<div class="posted">Posted by <span class="label label-danger"><a href="http://blog.miguelgrinberg.com/author/Miguel Grinberg">Miguel Grinberg</a></span> under <span class="label label-primary"><a href="../category/Python.html">Python</a></span>, <span class="label label-primary"><a href="../category/Flask.html">Flask</a></span>, <span class="label label-primary"><a href="../category/Programming.html">Programming</a></span>, <span class="label label-primary"><a href="../category/Raspberry%20Pi.html">Raspberry Pi</a></span>, <span class="label label-primary"><a href="../category/Video.html">Video</a></span>. </div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="video-streaming-with-flask.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>
<div class="post_body"><p>I'm sure by now you know that I have released a <a href="http://flaskbook.com/">book and a couple of videos on Flask</a> in cooperation with O'Reilly Media. While the coverage of the Flask framework in these is fairly complete, there are a small number of features that for one reason or another did not get mentioned much, so I thought it would be a good idea to write articles about them here.</p>
<p>This article is dedicated to <em>streaming</em>, an interesting feature that gives Flask applications the ability to provide large responses efficiently partitioned in small chunks, potentially over a long period of time. To illustrate the topic I'm going to show you how to build a live video streaming server!</p>
<h2>What is Streaming?</h2>
<p>Streaming is a technique in which the server provides the response to a request in chunks. I can think of a couple of reasons why this might be useful:</p>
<ul>
<li><strong>Very large responses</strong>. Having to assemble a response in memory only to return it to the client can be inefficient for very large responses. An alternative would be to write the response to disk and then return the file with <code>flask.send_file()</code>, but that adds I/O to the mix. Providing the response in small portions is a much better solution, assuming the data can be generated in chunks.</li>
<li><strong>Real time data</strong>. For some applications a request may need to return data that comes from a real time source. A pretty good example of this is a real time video or audio feed. A lot of security cameras use this technique to stream video to web browsers.</li>
</ul>
<h2>Implementing Streaming With Flask</h2>
<p>Flask provides native support for streaming responses through the use of <a href="http://legacy.python.org/dev/peps/pep-0255/">generator functions</a>. A generator is a special function that can be interrupted and resumed. Consider the following function:</p>
<pre><code>def gen():
    yield 1
    yield 2
    yield 3
</code></pre>
<p>This is a function that runs in three steps, each returning a value. Describing how generator functions are implemented is outside the scope of this article, but if you are a bit curious the following shell session will give you an idea of how generators are used:</p>
<pre><code>&gt;&gt;&gt; x = gen()
&gt;&gt;&gt; x
&lt;generator object gen at 0x7f06f3059c30&gt;
&gt;&gt;&gt; x.next()
1
&gt;&gt;&gt; x.next()
2
&gt;&gt;&gt; x.next()
3
&gt;&gt;&gt; x.next()
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
StopIteration
</code></pre>
<p>You can see in this simple example that a generator function can return multiple results in sequence. Flask uses this characteristic of generator functions to implement streaming.</p>
<p>The example below shows how using streaming it is possible to generate a large data table, without having to assemble the entire table in memory:</p>
<pre><code>from flask import Response, render_template
from app.models import Stock

def generate_stock_table():
    yield render_template('stock_header.html')
    for stock in Stock.query.all():
        yield render_template('stock_row.html', stock=stock)
    yield render_template('stock_footer.html')

@app.route('/stock-table')
def stock_table():
    return Response(generate_stock_table())
</code></pre>
<p>In this example you can see how Flask works with generator functions. A route that returns a streamed response needs to return a <code>Response</code> object that is initialized with the generator function. Flask then takes care of invoking the generator and sending all the partial results as chunks to the client.</p>
<p>For this particular example if you assume <code>Stock.query.all()</code> returns the result of a database query as an iterable, then you can generate a potentially large table one row at a time, so regardless of the number of elements in the query the memory consumption in the Python process will not grow larger and larger due to having to assemble a large response string.</p>
<h2>Multipart Responses</h2>
<p>The table example above generates a traditional page in small portions, with all the parts concatenated into the final document. This is a good example of how to generate large responses, but something a little bit more exciting is to work with real time data.</p>
<p>An interesting use of streaming is to have each chunk replace the previous one in the page, as this enables streams to "play" or animate in the browser window. With this technique you can have each chunk in the stream be an image, and that gives you a cool video feed that runs in the browser!</p>
<p>The secret to implement in-place updates is to use a <em>multipart</em> response. Multipart responses consist of a header that includes one of the multipart content types, followed by the parts, separated by a <em>boundary</em> marker and each having its own part specific content type.</p>
<p>There are several multipart content types for different needs. For the purpose of having a stream where each part replaces the previous part the <code>multipart/x-mixed-replace</code> content type must be used. To help you get an idea of how this looks, here is the structure of a multipart video stream:</p>
<pre><code>HTTP/1.1 200 OK
Content-Type: multipart/x-mixed-replace; boundary=frame

--frame
Content-Type: image/jpeg

&lt;jpeg data here&gt;
--frame
Content-Type: image/jpeg

&lt;jpeg data here&gt;
...
</code></pre>
<p>As you see above, the structure is pretty simple. The main <code>Content-Type</code> header is set to <code>multipart/x-mixed-replace</code> and a boundary string is defined. Then each part is included, prefixed by two dashes and the part boundary string in their own line. The parts have their own <code>Content-Type</code> header, and each part can optionally include a <code>Content-Length</code> header with the length in bytes of the part payload, but at least for images browsers are able to deal with the stream without the length.</p>
<h2>Building a Live Video Streaming Server</h2>
<p>There's been enough theory in this article, now it is time to build a complete application that streams live video to web browsers.</p>
<p>There are many ways to stream video to browsers, and each method has its benefits and disadvantages. The method that works well with the streaming feature of Flask is to stream a sequence of independent JPEG pictures. This is called <a href="http://en.wikipedia.org/wiki/Motion_JPEG">Motion JPEG</a>, and is used by many IP security cameras. This method has low latency, but quality is not the best, since JPEG compression is not very efficient for motion video.</p>
<p>Below you can see a surprisingly simple, yet complete web application that can serve a Motion JPEG stream:</p>
<pre><code>#!/usr/bin/env python
from flask import Flask, render_template, Response
from camera import Camera

app = Flask(__name__)

@app.route('/')
def index():
    return render_template('index.html')

def gen(camera):
    while True:
        frame = camera.get_frame()
        yield (b'--frame\r\n'
               b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')

@app.route('/video_feed')
def video_feed():
    return Response(gen(Camera()),
                    mimetype='multipart/x-mixed-replace; boundary=frame')

if __name__ == '__main__':
    app.run(host='0.0.0.0', debug=True)
</code></pre>
<p>This application imports a <code>Camera</code> class that is in charge of providing the sequence of frames. Putting the camera control portion in a separate module is a good idea in this case, this way the web application remains clean, simple and generic.</p>
<p>The application has two routes. The <code>/</code> route serves the main page, which is defined in the <code>index.html</code> template. Below you can see the contents of this template file:</p>
<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Video Streaming Demonstration&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Video Streaming Demonstration&lt;/h1&gt;
    &lt;img src="{{ url_for('video_feed') }}"&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>This is a simple HTML page with just a heading and an image tag. Note that the image tag's <code>src</code> attribute points to the second route of this application, and this is where the magic happens.</p>
<p>The <code>/video_feed</code> route returns the streaming response. Because this stream returns the images that are to be displayed in the web page, the URL to this route is in the <code>src</code> attribute of the image tag. The browser will automatically keep the image element updated by displaying the stream of JPEG images in it, since multipart responses are supported in most/all browsers (let me know if you find a browser that doesn't like this).</p>
<p>The generator function used in the <code>/video_feed</code> route is called <code>gen()</code>, and takes as an argument an instance of the <code>Camera</code> class. The <code>mimetype</code> argument is set as shown above, with the <code>multipart/x-mixed-replace</code> content type and a boundary set to the string <code>"frame"</code>.</p>
<p>The <code>gen()</code> function enters a loop where it continuously returns frames from the camera as response chunks. The function asks the camera to provide a frame by calling the <code>camera.get_frame()</code> method, and then it yields with this frame formatted as a response chunk with a content type of <code>image/jpeg</code>, as shown above.</p>
<h2>Obtaining Frames from a Video Camera</h2>
<p>Now all that is left is to implement the <code>Camera</code> class, which will have to connect to the camera hardware and download live video frames from it. The nice thing about encapsulating the hardware dependent part of this application in a class is that this class can have different implementations for different people, but the rest of the application remains the same. You can think of this class as a device driver, which provides a uniform implementation regardless of the actual hardware device in use.</p>
<p>The other advantage of having the <code>Camera</code> class separated from the rest of the application is that it is easy to fool the application into thinking there is a camera when in reality there is not, since the camera class can be implemented to emulate a camera without real hardware. In fact, while I was working on this application, the easiest way for me to test the streaming was to do that and not have to worry about the hardware until I had everything else running. Below you can see the simple emulated camera implementation that I used:</p>
<pre><code>from time import time

class Camera(object):
    def __init__(self):
        self.frames = [open(f + '.jpg', 'rb').read() for f in ['1', '2', '3']]

    def get_frame(self):
        return self.frames[int(time()) % 3]
</code></pre>
<p>This implementation reads three images from disk called <code>1.jpg</code>, <code>2.jpg</code> and <code>3.jpg</code> and then returns them one after another repeatedly, at a rate of one frame per second. The <code>get_frame()</code> method uses the current time in seconds to determine which of the three frames to return at any given moment. Pretty simple, right?</p>
<p>To run this emulated camera I needed to create the three frames. Using <a href="http://www.gimp.org/">gimp</a> I've made the following images:</p>
<p><img alt="Frame 1" src="../static/images/video-streaming-1.jpg" /> <img alt="Frame 2" src="../static/images/video-streaming-2.jpg" /> <img alt="Frame 3" src="../static/images/video-streaming-3.jpg" /></p>
<p>Because the camera is emulated, this application runs on any environment, so you can run this right now! I have this application all ready to go on <a href="https://github.com/miguelgrinberg/flask-video-streaming">GitHub</a>. If you are familiar with <code>git</code> you can clone it with the following command:</p>
<pre><code>$ git clone https://github.com/miguelgrinberg/flask-video-streaming.git
</code></pre>
<p>If you prefer to download it, then you can get a zip file <a href="https://codeload.github.com/miguelgrinberg/flask-video-streaming/zip/master">here</a>.</p>
<p>Once you have the application installed, create a virtual environment and install Flask in it. Then you can run the application as follows:</p>
<pre><code>$ python app.py
</code></pre>
<p>After you start the application enter <code>http://localhost:5000</code> in your web browser and you will see the emulated video stream playing the 1, 2 and 3 images over and over. Pretty cool, right?</p>
<p>Once I had everything working I fired up my Raspberry Pi with its camera module and implemented a new <code>Camera</code> class that converts the Pi into a video streaming server, using the <code>picamera</code> package to control the hardware. I will not discuss this camera implementation here, but you can find it in the source code in file <code>camera_pi.py</code>.</p>
<p>If you have a Raspberry Pi and a camera module you can edit <code>app.py</code> to import the <code>Camera</code> class from this module and then you will be able to live stream the Pi camera, like I'm doing in the following screenshot:</p>
<p><img alt="Frame 1" src="../static/images/video-streaming-3.png" /></p>
<p>If you want to make this streaming application work with a different camera, then all you need to do is write another implementation of the <code>Camera</code> class. If you end up writing one I would appreciate it if you contribute it to my GitHub project.</p>
<h2>Limitations of Streaming</h2>
<p>When the Flask application serves regular requests the request cycle is short. The web worker receives the request, invokes the handler function and finally returns the response. Once the response is sent back to the client the worker is free and ready to take on another request.</p>
<p>When a request that uses streaming is received, the worker remains attached to the client for the duration of the stream. When working with long, never ending streams such as a video stream from a camera, a worker will stay locked to the client until the client disconnects. This effectively means that unless specific measures are taken, the application can only serve as many clients as there are web workers. When working with the Flask application in debug mode that means just one, so you will not be able to connect a second browser window to watch the stream from two places at the same time.</p>
<p>There are ways to overcome this important limitation. The best solution in my opinion is to use a coroutine based web server such as <a href="http://www.gevent.org/">gevent</a>, which Flask fully supports. With the use of coroutines gevent is able to handle multiple clients on a single worker thread, as gevent modifies the Python I/O functions to issue context switches as necessary.</p>
<h2>Conclusion</h2>
<p>In case you missed it above, the code that supports this article is this GitHub repository: <a href="https://github.com/miguelgrinberg/flask-video-streaming">https://github.com/miguelgrinberg/flask-video-streaming</a>. Here you can find a generic implementation of video streaming that does not require a camera, and also an implementation for the Raspberry Pi camera module.</p>
<p>I hope this article shed some light on the topic of streaming. I concentrated on video streaming because that is an area I have some experience, but streaming has many more uses besides video. For example, this technique can be used to keep a connection between the client and the server alive for a long time, allowing the server to push new information the moment it becomes available. These days the Web Socket protocol is a more efficient way to achieve this, but Web Socket is fairly new and works only in modern browsers, while streaming will work on pretty much any browser you can think of.</p>
<p>If you have any questions feel free to write them below. I plan to continue documenting more of the not well known Flask topics, so I hope you connect with me in some way to know when more articles are published. I hope to see you in the next one!</p>
<p>Miguel</p></div>
<div class="social-bar">
    <table>
        <tr>
            <td><div class="social-box" style="padding-top: 8px;"><a href="https://twitter.com/share" class="twitter-share-button" data-url="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-via="miguelgrinberg" data-count="vertical">Tweet</a></div></td>
            <td><div class="social-box" style="padding-left: 6px;"><div class="fb-like" data-href="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-send="false" data-layout="box_count" data-width="450" data-show-faces="false" data-font="verdana"></div></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><g:plusone href="video-streaming-with-flask.html" size="tall"></g:plusone></div></td>
            <td><div class="social-box" style="padding-top: 8px;"><script type="IN/Share" data-url="http://blog.miguelgrinberg.com/post/video-streaming-with-flask" data-counter="top"></script></div></td>
        </tr>
    </table>
</div>


<h4 style="text-align: right"><a name="comments"></a>103 comments</h4>


<div class="comment">
    <ul>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/1d5069f331c84cac4537e1ed54698574ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#1</span> <span class="label label-primary">pypy</span> said
                    <span class="flask-moment" data-timestamp="2014-10-21T02:48:28Z" data-format="fromNow(0)" data-refresh="0">2014-10-21T02:48:28Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Great!!! </p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/f34b36e5ad86d34c0d87727aede8dc94ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#2</span> <span class="label label-primary">dorian</span> said
                    <span class="flask-moment" data-timestamp="2014-10-23T12:15:04Z" data-format="fromNow(0)" data-refresh="0">2014-10-23T12:15:04Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">What would you suggest is the best open-source platform/script/server for streaming video ?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#3</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-23T14:45:50Z" data-format="fromNow(0)" data-refresh="0">2014-10-23T14:45:50Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@dorian: tough question to answer, as there are many factors that affect your decision. If you want to stream pre-recorded video then the problem gets simplified enormously, you can just use ffmpeg to encode your video as an HLS stream or other adaptive bitrate formats. These are nice because for each client the most appropriate quality/bitrate is served dynamically. For live video the adaptive bitrate formats have a few seconds of latency, so if the goal is to reduce latency at the cost of quality then a Motion-JPEG solution similar to what I present in this article is a good idea.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/f34b36e5ad86d34c0d87727aede8dc94ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#4</span> <span class="label label-primary">dorian again</span> said
                    <span class="flask-moment" data-timestamp="2014-10-23T15:03:21Z" data-format="fromNow(0)" data-refresh="0">2014-10-23T15:03:21Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@miguel: true with hls and just use nginx or whatever, but adaptive-streaming is also required for browsers/players that don&#39;t support HLS.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#5</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-23T16:40:05Z" data-format="fromNow(0)" data-refresh="0">2014-10-23T16:40:05Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@dorian: HLS and similar methods basically push most of the complexity to the client, so you can only stream to clients that understand how to work with adaptive bitrate streams. HLS is supported natively by the browsers in iOS and Android. On the desktop some browsers need a third-party Javascript library. Also HLS, backed by Apple, is not the only adaptive bitrate format, there are a few more from Microsoft, Adobe, and others.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/1432d95a54f748d0f607e8235c6e6280ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#6</span> <span class="label label-primary">Jos M. Alonso</span> said
                    <span class="flask-moment" data-timestamp="2014-10-24T12:04:03Z" data-format="fromNow(0)" data-refresh="0">2014-10-24T12:04:03Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Great Thanks, Miguel. I am already watching at work images sent by my Raspberry Pi from my home, only a problem:  the images are inverted.
I would appreciate vey much a suggestion.
Jose</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#7</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-24T14:45:24Z" data-format="fromNow(0)" data-refresh="0">2014-10-24T14:45:24Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Jos: look in &#34;camera_pi.py&#34;, I have flip vertical and horizontal settings there. Just revert them and you will be fine.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/1432d95a54f748d0f607e8235c6e6280ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#8</span> <span class="label label-primary">Jose M Alonso</span> said
                    <span class="flask-moment" data-timestamp="2014-10-27T16:28:08Z" data-format="fromNow(0)" data-refresh="0">2014-10-27T16:28:08Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thanks again. It works perfectly now! Let me ask you an additional  question. Could it be possible to control the access of browsers to the video streaming?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#9</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-27T17:05:21Z" data-format="fromNow(0)" data-refresh="0">2014-10-27T17:05:21Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Jose: sure, you can apply standard authentication/authorization techniques to control access to the stream. See my tutorials in this blog for more information.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/e93e6b30e4c50ff07d2f5c9d624589c4ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#10</span> <span class="label label-primary">cyber_lis</span> said
                    <span class="flask-moment" data-timestamp="2014-10-29T08:22:26Z" data-format="fromNow(0)" data-refresh="0">2014-10-29T08:22:26Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Can you show example of streaming of pre-recorded video?</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#11</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-10-29T17:18:40Z" data-format="fromNow(0)" data-refresh="0">2014-10-29T17:18:40Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@cyber_lis: to stream pre-recorded video you can just serve the video file as a regular file. You can encode it as mp4 with ffmpeg, for example, or if you want something more sophisticated you can encode a multi-resolution HLS stream. Either way you just need to serve the static files, you don&#39;t need Flask for that.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/0048452e61bbfd81be2278fef58990f3ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#12</span> <span class="label label-primary">Thomas Sarmis</span> said
                    <span class="flask-moment" data-timestamp="2014-11-17T17:56:11Z" data-format="fromNow(0)" data-refresh="0">2014-11-17T17:56:11Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">I altered the app.run(host=&#39;0.0.0.0&#39;, port=80, debug=False) but still I am only capable of getting at most one stream at a time. Am I missing something here? - Shouldn&#39;t this change make more than one feed&#39;s possible? (I am running the app with sudo python app.py)</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#13</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-17T18:49:34Z" data-format="fromNow(0)" data-refresh="0">2014-11-17T18:49:34Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Thomas: this is explained in the section &#34;Limitations of Streaming&#34; above. If you have one worker then you can only serve one client at a time. You can run the application under Gunicorn for example, and specify a number of worker processes, or go with gevent as I suggest in the article.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/0048452e61bbfd81be2278fef58990f3ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#14</span> <span class="label label-primary">Thomas</span> said
                    <span class="flask-moment" data-timestamp="2014-11-18T18:05:54Z" data-format="fromNow(0)" data-refresh="0">2014-11-18T18:05:54Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Miguel In the article it states that:
&#34;When working with the Flask application in debug mode that means just one, so you will not be able to connect a second browser window to watch the stream from two places at the same time.&#34;

My understanding was that setting debug = False would allow for more worker threads and thus more connections. What am I missing here? 

(I will also check the Gunicon/Gevent solutions, but I m unfamiliar with linux and python so I was looking to setup something simple first...)

</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#15</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-20T00:44:03Z" data-format="fromNow(0)" data-refresh="0">2014-11-20T00:44:03Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Thomas: I meant &#34;debug mode&#34; as in &#34;not production&#34;. When you run in production you have a web server with a few workers, or else gevent, which can handle multiple clients with a single worker. Werkzeug is not meant to be used for production, though there is an option to run it in multi-threaded mode that may allow it to handle multiple clients with streaming video. This is enabled by calling app.run(threaded=True).</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/c1844787154d77e6cce08a21c2bd4555ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#16</span> <span class="label label-primary">Thomas</span> said
                    <span class="flask-moment" data-timestamp="2014-11-20T20:10:59Z" data-format="fromNow(0)" data-refresh="0">2014-11-20T20:10:59Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Yeah, I kinda guess that, from searching around yesterday - I also tried gevent/gunicorn, but I have run into two major problems
(A) A single camera access thread must be used and then share the buffers to all clients
(B) I am not sure that the worker per client approach is the best one in this case - I am thinking of something like single thread with multiple tcp connection and a for loop to try to send each image to every client and then move forward... 

Anyway your post was extremely usefull in understanding flash and streaming...
Thank you</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#17</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-21T06:27:53Z" data-format="fromNow(0)" data-refresh="0">2014-11-21T06:27:53Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Thomas: (A) The camera class creates a single background thread. See here: https://github.com/miguelgrinberg/flask-video-streaming/blob/master/camera_pi.py#L14.
(B) That is what gevent more or less does through coroutines. You could build something custom that does what you describe, but then you are going to have trouble using Flask, which assumes a WSGI environment.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/0048452e61bbfd81be2278fef58990f3ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#18</span> <span class="label label-primary">Thomas</span> said
                    <span class="flask-moment" data-timestamp="2014-11-21T15:31:00Z" data-format="fromNow(0)" data-refresh="0">2014-11-21T15:31:00Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">(A) You are right, I supposed that managed to misuse gevent and i got a camera resources error. In Flask (theaded=True) works fine
(B) I am building a small baby monitor app and I am assuming no more that 2-6 clients. Since Flash works OK with that, I don&#39;t need production quality software for the initial version

Thank you again...</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#19</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-11-23T00:28:40Z" data-format="fromNow(0)" data-refresh="0">2014-11-23T00:28:40Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Thomas: excellent, glad to know threaded=True works. I completely agree, by the way, if this is going to be a small server for your family I would also take the least pain route, I don&#39;t see any problems with using the threaded Werkzeug if it gets the job done.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/a1844bf284879869b78da7964b405a48ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#20</span> <span class="label label-primary">Marcel Maré</span> said
                    <span class="flask-moment" data-timestamp="2014-12-07T19:34:28Z" data-format="fromNow(0)" data-refresh="0">2014-12-07T19:34:28Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Thanks Miguel. This has been very helpful to me. I was surprised how well it works with the Pi camera. Especially since I&#39;ve tried a lot of linuxy or javascript solutions, but they have much longer latency. 
With the threaded=True is also works for multiple streams. Very nice. 
I&#39;d appreciate another tutorial expanding on Flask+gevent+streaming. 

Thanks again!</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#21</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-12-08T17:30:08Z" data-format="fromNow(0)" data-refresh="0">2014-12-08T17:30:08Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Marcel: the drawback of this method versus others is video quality, which is inferior to other streaming methods that have longer latencies. To use gevent there are no code changes required, you just need to &#34;pip install gevent&#34; and launch the server as shown in the flask official documentation: http://flask.pocoo.org/docs/0.10/deploying/wsgi-standalone/#gevent.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/3d56face555bed51f9ecd38957998286ce2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#22</span> <span class="label label-primary">Eduardo</span> said
                    <span class="flask-moment" data-timestamp="2014-12-18T12:40:39Z" data-format="fromNow(0)" data-refresh="0">2014-12-18T12:40:39Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel,

Thanks for this great article. I&#39;d like to ask how about having the camera class reading from remote cameras. I want to read from remote cameras and serve their feeds through my streaming server like an CCTV application.

Thanks very much</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/cf23963beefe5f9fddb2d4f6cb0525bece2c.png?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#23</span> <span class="label label-primary">Log0</span> said
                    <span class="flask-moment" data-timestamp="2014-12-18T13:12:40Z" data-format="fromNow(0)" data-refresh="0">2014-12-18T13:12:40Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">Hi Miguel, what are the specifics that I&#39;m missing to get this to work? Your jpeg works but using this implementation shows a &#34;broken image&#34; icon.

I&#39;m trying to make a real simple webcam video streaming (cv2.VideoCapture), but currently using just a simple video as a replacement for testing.

class Camera(object):
    def __init__(self):
        self.video = cv2.VideoCapture(&#39;video.mp4&#39;)
    
    def __del__(self):
        self.video.release()
    
    def get_frame(self):
        success, image = self.video.read()
        if not success:
            print &#39;Failing&#39;
        image_bytes = image.tobytes()
        return image_bytes

Thanks.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#24</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-12-19T06:56:01Z" data-format="fromNow(0)" data-refresh="0">2014-12-19T06:56:01Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Eduardo: you can write a camera class to get the video frames in any way, even by talking to a remote camera. But I&#39;m not sure this is a good idea, you can also serve the HTML page with code that contacts the remote camera directly and save the extra trip to the Pi.</p>
                </div>
            </div>
        </li>
        
        <li>
            <div class="comment-thumbnail"><img src="../../gravatar.com/avatar/729e26a2a2c7ff24a71958d4aa4e5f35ce2c.jpeg?s=60&amp;d=identicon" /></div>
            <div class="comment-body">
                <p>
                    <span class="label label-default">#25</span> <span class="label label-danger">Miguel Grinberg</span> said
                    <span class="flask-moment" data-timestamp="2014-12-19T06:57:43Z" data-format="fromNow(0)" data-refresh="0">2014-12-19T06:57:43Z</span>
                </p>
                <div style="overflow: auto;">
                    <p style="white-space: pre-wrap;">@Log0: you need to return jpeg images, that is the only format supported in a MJPEG stream. I suspect those bytes that you are returning are an uncompressed image buffer. You just need to turn that into a jpeg.</p>
                </div>
            </div>
        </li>
        
    </ul>
</div>

<div class="page">
<ul class="pager">
  <li class="previous disabled">
    <a href="#">&laquo;&laquo;</a>
  </li>
  <li class="previous disabled">
    <a href="#">&laquo;</a>
  </li>
  <li class="next">
    <a href="video-streaming-with-flask/page/0.html#comments">&raquo;&raquo;</a>
  </li>
  <li class="next">
    <a href="video-streaming-with-flask/page/2.html#comments">&raquo;</a>
  </li>
</ul>
</div>

<h3><a name="commentform"></a>Leave a Comment</h3>

<form action="#commentform" method="post"
  class="form" role="form">
  <div style="display:none;"><input id="csrf_token" name="csrf_token" type="hidden" value="1439536752.02##08d0d2375557c5f9283331c7ef39eefb92a27c1c"></div>
  
    
    






<div class="form-group "><label class="control-label" for="name">Name</label>
        <input class="form-control" id="name" name="name" required type="text" value="">
  </div>


    




<div class="form-group "><label class="control-label" for="url">URL</label>
        <input class="form-control" id="url" name="url" type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="email">Email</label>
        <input class="form-control" id="email" name="email" required type="text" value="">
  </div>


    






<div class="form-group "><label class="control-label" for="comment">Comment</label>
        <textarea class="form-control" id="comment" name="comment" required></textarea>
  </div>


    




<div class="form-group "><label class="control-label" for="captcha">Captcha</label>
        
<script type="text/javascript">var RecaptchaOptions = {"custom_translations": {"audio_challenge": "Get an audio challenge", "cant_hear_this": "Download sound as MP3", "help_btn": "Help", "image_alt_text": "reCAPTCHA challenge image", "incorrect_try_again": "Incorrect. Try again.", "instructions_audio": "Type what you hear", "instructions_visual": "Type the text", "play_again": "Play sound again", "privacy_and_terms": "Privacy & Terms", "refresh_btn": "Get a new challenge", "visual_challenge": "Get a visual challenge"}, "theme": "white"};</script>
<script type="text/javascript" src="http://www.google.com/recaptcha/api/challenge?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S"></script>
<noscript>
  <iframe src="http://www.google.com/recaptcha/api/noscript?k=6Ld5Zs4SAAAAAOY0DOi4r18bgHlEaz41qAoRf__S" height="300" width="500" frameborder="0"></iframe><br>
  <textarea name="recaptcha_challenge_field" rows="3" cols="40"></textarea>
  <input type="hidden" name="recaptcha_response_field" value="manual_challenge">
</noscript>

  </div>


    





  


    <input class="btn btn-default" id="submit" name="submit" type="submit" value="Submit">
  





</form>


</div>

                </div>
            </div>
        </div>
        <div id="footer">
            <p class="elapsed">This page was generated in None seconds.</p>
            <p>&copy; 2014 by Miguel Grinberg. All rights reserved. <a href="mailto:webmaster _at_ miguelgrinberg _dot_ com">Questions?</a></p>
        </div>
    </div>


    
    
    <script src="../../cdnjs.cloudflare.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="../../cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.0/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="../../cdnjs.cloudflare.com/ajax/libs/jquery.colorbox/1.4.33/jquery.colorbox-min.js"></script>
    <script type="text/javascript" src="../static/prettify.js"></script>
    <script src="../../cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment-with-langs.min.js"></script>
<script>
function flask_moment_render(elem) {
    $(elem).text(eval('moment("' + $(elem).data('timestamp') + '").' + $(elem).data('format') + ';'));
    $(elem).removeClass('flask-moment');
}
function flask_moment_render_all() {
    $('.flask-moment').each(function() {
        flask_moment_render(this);
        if ($(this).data('refresh')) {
            (function(elem, interval) { setInterval(function() { flask_moment_render(elem) }, interval); })(this, $(this).data('refresh'));
        }
    })
}
$(document).ready(function() {
    flask_moment_render_all();
});
</script>
    
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-4777284-15']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    
    <script type="text/javascript">
        $(document).ready(function(){
            $(".gallery").colorbox({rel:".gallery",maxWidth:"95%",maxHeight:"95%",scalePhotos:true});
            // add prettyprint class to all <pre><code></code></pre> blocks
            var prettify = false;
            $("pre code").parent().each(function() {
                $(this).addClass('prettyprint');
                prettify = true;
            });
            prettyPrint();
        });
    </script>


  </body>

<!-- Mirrored from blog.miguelgrinberg.com/post/video-streaming-with-flask by HTTrack Website Copier/3.x [XR&CO'2014], Fri, 14 Aug 2015 06:45:18 GMT -->
</html>
